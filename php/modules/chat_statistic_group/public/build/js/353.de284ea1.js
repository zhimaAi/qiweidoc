"use strict";(self["webpackChunkzmwk_session_archive"]=self["webpackChunkzmwk_session_archive"]||[]).push([[353],{558:function(e,t,l){l.r(t),l.d(t,{default:function(){return Z}});l(4114);var a=l(6768),s=l(4232),n=l(5130),u=l(144),i=l(1387),o=l(7694),r=l(2281),c={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H544V328c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v152H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h152v152c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V544h152c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"plus-circle",theme:"outlined"},d=c,f=l(4827);function p(e){for(var t=1;t<arguments.length;t++){var l=null!=arguments[t]?Object(arguments[t]):{},a=Object.keys(l);"function"===typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(l).filter((function(e){return Object.getOwnPropertyDescriptor(l,e).enumerable})))),a.forEach((function(t){g(e,t,l[t])}))}return e}function g(e,t,l){return t in e?Object.defineProperty(e,t,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[t]=l,e}var v=function(e,t){var l=p({},e,t.attrs);return(0,a.bF)(f.A,p({},l,{icon:d}),null)};v.displayName="PlusCircleOutlined",v.inheritAttrs=!1;var m=v,_=l(5226),k=l(3536),y=l(8298);const b={class:"times-range-container"},h={class:"time-range-title"},w={class:"text"},C={class:"time-range-body"},F={class:"times"},x={class:"operator-box ml8"};var L={__name:"timesRange",props:{limit:{type:Number,default:5},timeLimit:{type:Number,default:5},disabled:{type:Boolean,default:!1},showAddBtn:{type:Boolean,default:!0}},emits:["change"],setup(e,{expose:t,emit:l}){const n=l,i=e,o={times:[]},c={week:[],ranges:[(0,y.t0)(o)]},d=(0,u.KR)([{...c}]);function f(){d.value.length>=i.limit||(d.value.push((0,y.t0)(c)),W())}function p(e){i.disabled||1===d.value.length||(d.value.splice(e,1),W())}function g(e){i.disabled||e.ranges.length>=i.timeLimit||(e.ranges.push((0,y.t0)(o)),W())}function v(e,t){i.disabled||1===e.ranges.length||(e.ranges.splice(t,1),W())}function L(e,t){let l;for(let a=0;a<d.value.length;a++)if(l=d.value[a],a!==e&&l.week.includes(t.value))return!0;return!1}function S(){let e=(0,y.t0)(d.value);if(e=e.filter((e=>(e.times=e.ranges.filter((e=>e.times.length>0)),e.week.length>0&&e.times.length>0))),!e.length)return{ok:!1,error:"请至少完善一条时段规则"};for(let t of e){let e=t.ranges.map((e=>[(0,y.EF)(e.times[0]),(0,y.EF)(e.times[1])]));if((0,y.dj)(...e))return{ok:!1,error:"工作时间段存在重叠，请检查后重新选择"}}return{ok:!0}}function R(){let e=(0,y.t0)(d.value);return e=e.filter((e=>(e.times=e.ranges.filter((e=>e.times.length>0)),e.week=e.week.sort(),e.week.length>0&&e.times.length>0))),e}function E(e){e.length&&(d.value=e)}function W(){n("change")}return t({input:E,output:R,verify:S}),(t,l)=>{const n=(0,a.g2)("a-checkbox"),i=(0,a.g2)("a-checkbox-group"),o=(0,a.g2)("a-time-range-picker"),c=(0,a.g2)("a-button");return(0,a.uX)(),(0,a.CE)("div",b,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(d.value,((t,l)=>((0,a.uX)(),(0,a.CE)("div",{class:"time-range-item",key:l},[(0,a.Lk)("div",h,[(0,a.Lk)("span",w,"时间段"+(0,s.v_)(l+1),1),(0,a.bF)((0,u.R1)(r.A),{class:(0,s.C4)(["del",{disabled:e.disabled||d.value.length<2}]),onClick:e=>p(l)},null,8,["class","onClick"])]),(0,a.Lk)("div",C,[(0,a.bF)(i,{value:t.week,"onUpdate:value":e=>t.week=e,disabled:e.disabled,onChange:W},{default:(0,a.k6)((()=>[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)((0,u.R1)(y.QM),(e=>((0,a.uX)(),(0,a.Wv)(n,{key:e.value,value:e.value,disabled:L(l,e)},{default:(0,a.k6)((()=>[(0,a.eW)((0,s.v_)(e.label),1)])),_:2},1032,["value","disabled"])))),128))])),_:2},1032,["value","onUpdate:value","disabled"]),(0,a.Lk)("div",F,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(t.ranges,((l,n)=>((0,a.uX)(),(0,a.CE)("div",{class:"time-item",key:n},[(0,a.bF)(o,{value:l.times,"onUpdate:value":e=>l.times=e,disabled:e.disabled,onChange:W,style:{width:"300px"},format:"HH:mm","value-format":"HH:mm","show-time":{format:"HH:mm"},placeholder:["开始时间","结束时间"]},null,8,["value","onUpdate:value","disabled"]),(0,a.Lk)("div",x,[(0,a.bF)((0,u.R1)(m),{class:(0,s.C4)(["add",{disabled:e.disabled||t.ranges.length>=e.timeLimit}]),onClick:e=>g(t)},null,8,["class","onClick"]),(0,a.bF)((0,u.R1)(_.A),{class:(0,s.C4)(["remove ml8",{disabled:e.disabled||t.ranges.length<2}]),onClick:e=>v(t,n)},null,8,["class","onClick"])])])))),128))])])])))),128)),e.showAddBtn?((0,a.uX)(),(0,a.Wv)(c,{key:0,disabled:e.disabled||d.value.length>=e.limit,type:"dashed",icon:(0,a.h)((0,u.R1)(k.A)),onClick:f,style:{width:"100%"}},{default:(0,a.k6)((()=>l[0]||(l[0]=[(0,a.eW)("添加时间段 ")]))),_:1},8,["disabled","icon"])):(0,a.Q3)("",!0)])}}},S=l(1241);const R=(0,S.A)(L,[["__scopeId","data-v-676c50b6"]]);var E=R,W=l(7159),X=l(8589),z=l(706),A=l(7767);const K={key:0,style:{display:"flex","flex-wrap":"wrap"}},T={key:0,class:"fx-ac",style:{flex:"1"}},j={key:0,class:"fx-ac",style:{flex:"1"}};var B={__name:"select-staff-box-normal",props:{title:{type:String,default:"选择员工"},btnText:{type:String,default:"添加员工"},btnType:{type:String,default:"dashed"},btnStyle:{type:String,default:"margin-right: 16px;"},showSelectStaff:{type:Boolean,default:!0},showClearSelectStaff:{type:Boolean,default:!1},selectType:{default:"multiple"},showStaffApproveTip:{default:!1},selectedStaffs:{type:Array,default(){return[]}},isTag:{type:Boolean,default:!0},showSeatTip:{type:Boolean,default:!1},maxShowWidth:{}},emits:"change",setup(e,{emit:t}){const l=t,n=e,i=(0,u.KR)(null),o=(0,a.EW)((()=>n.selectedStaffs)),r=e=>{o.value=e,l("change",e||[])},c=e=>{o.value.splice(e,1),l("change",o.value)},d=()=>{n.showClearSelectStaff?i.value.show([]):i.value.show(o.value)};return(0,a.sV)((()=>{})),(t,l)=>{const n=(0,a.g2)("a-button"),f=(0,a.g2)("a-avatar"),p=(0,a.g2)("a-tooltip"),g=(0,a.g2)("a-tag");return(0,a.uX)(),(0,a.CE)("div",null,[(0,a.bF)(n,{type:e.btnType,style:(0,s.Tr)(e.btnStyle),onClick:d},{default:(0,a.k6)((()=>[(0,a.bF)((0,u.R1)(k.A)),(0,a.eW)(" "+(0,s.v_)(e.btnText),1)])),_:1},8,["type","style"]),e.showSelectStaff?((0,a.uX)(),(0,a.CE)("div",K,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(o.value,((t,l)=>((0,a.uX)(),(0,a.Wv)(g,{key:t.userid,closable:"",onClose:e=>c(l),style:{"margin-top":"6px"},class:(0,s.C4)(["fx-ac tag",{"red-tip":e.showSeatTip&&!t.is_bind_license}])},{default:(0,a.k6)((()=>[(0,a.bF)(p,null,{default:(0,a.k6)((()=>[e.showSeatTip?((0,a.uX)(),(0,a.CE)("div",T,[(0,a.bF)(f,{size:20,src:(0,u.R1)(A),style:{"margin-right":"4px"}},null,8,["src"]),(0,a.Lk)("span",null,(0,s.v_)(t.name),1)])):(0,a.Q3)("",!0)])),_:2},1024),e.showSeatTip?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("div",j,[(0,a.bF)(f,{size:20,src:(0,u.R1)(A),style:{"margin-right":"4px"}},null,8,["src"]),(0,a.Lk)("span",null,(0,s.v_)(t.name),1)]))])),_:2},1032,["onClose","class"])))),128))])):(0,a.Q3)("",!0),(0,a.bF)((0,u.R1)(z.A),{selectType:"multiple",ref_key:"setStaff",ref:i,onChange:l[0]||(l[0]=e=>r(e))},null,512)])}}};const O=(0,S.A)(B,[["__scopeId","data-v-123a009c"]]);var U=O;const I={class:"zm-main-box"},H={class:"zm-flex-center"},N={class:"zm-flex-center"},P={key:0,class:"mt10"},Q={class:"tips"},D={key:0,class:"mt10"},V={class:"main-body",style:{"padding-bottom":"120px"}},M={class:"keyword-tags"},J={class:"keyword-tags"},Y={class:"zm-fixed-bottom-box in-module"},$={class:"mt16 text-right"};var q={__name:"rule",setup(e){const t=(0,i.rd)(),l=(0,u.KR)(!1),r=(0,u.KR)(!1),c=(0,u.KR)(!1),d=(0,u.KR)(null),f=((0,u.KR)([]),(0,u.Kh)({cst_keywords_full:"",cst_keywords_half:""})),p=(0,u.Kh)({at_msg_reply_sec:3,msg_reply_sec:3,cst_keywords:{full:[],half:[],msg_type_filter:[]},work_time:[],other_effect:!1,group_staff_type:1,group_staff_ids:[],group_staff_info:[]}),g=(0,u.KR)(null);async function v(){l.value=!0,await(0,X.zj)().finally((()=>{l.value=!1})).then((e=>{let t=e?.data||{};t.group_staff_type=t.group_staff_type||1,(0,y.AB)(p,t);let l=p.work_time.map((e=>{let t=e.range.map((e=>({times:[e.s,e.e]})));return{week:e.week,ranges:t}}));d.value.input(l),(0,a.dY)((()=>{g.value=JSON.stringify({config:p,timeData:d.value.output()})}))}))}function m(){if(g.value){let e=JSON.stringify({config:p,timeData:d.value.output()});g.value!=e?c.value=!0:c.value=!1}}function _(e){p.group_staff_info=e,p.group_staff_ids=e.map((e=>e.userid))}function k(e,t){let l;try{l=e+"_"+t;let a=f[l].trim();if(!a)return;if(p[e][t].length>19)throw"每项最多输入20个关键词";if(p[e].half.includes(a)||p[e].full.includes(a))throw"请勿重复输入关键字";p[e][t].push(a)}catch(a){o.Ay.error(a)}f[l]="",m()}function b(e,t,l,a){a.preventDefault(),p[e][t].splice(l,1),m()}function h(){t.push({path:"/module/chat-statistic-group/index"})}async function w(){try{r.value=!0;let e=d.value.verify();if(!e.ok)throw e.error;if(p.other_effect&&1===p.group_staff_type&&!p.group_staff_ids.length)throw"请选择指定员工";let t=d.value.output();t=t.map((e=>{let t=e.ranges.map((e=>({s:e.times[0],e:e.times[1]})));return{week:e.week,range:t}}));let l={...p,work_time:t};l.other_effect=Number(l.other_effect),delete l.group_staff_info,await(0,X.Nk)(l),await v(),c.value=!1,o.Ay.success("已保存")}catch(e){console.log("Err:",e),"string"===typeof e&&o.Ay.error(e)}r.value=!1}return(0,a.sV)((()=>{v()})),(e,t)=>{const l=(0,a.g2)("a-card"),u=(0,a.g2)("a-input-number"),i=(0,a.g2)("a-form-item"),o=(0,a.g2)("a-checkbox"),g=(0,a.g2)("a-radio"),v=(0,a.g2)("a-radio-group"),y=(0,a.g2)("a-alert"),C=(0,a.g2)("a-input"),F=(0,a.g2)("a-tag"),x=(0,a.g2)("a-checkbox-group"),L=(0,a.g2)("a-button"),S=(0,a.g2)("a-popover");return(0,a.uX)(),(0,a.CE)("div",null,[(0,a.bF)(W.A,{active:"rule"}),(0,a.Lk)("div",I,[(0,a.bF)(l,{bordered:!1},{title:(0,a.k6)((()=>t[12]||(t[12]=[(0,a.Lk)("div",{class:"card-title"},[(0,a.Lk)("span",{class:"title"},"工作时间段设置"),(0,a.Lk)("span",{class:"desc"},"设置工作时间段后，则仅对设定的时间段内对开启会话存档的员工的所在群进行工作质量检测")],-1)]))),default:(0,a.k6)((()=>[(0,a.bF)(E,{ref_key:"timeRangeRef",ref:d,onChange:m},null,512)])),_:1}),(0,a.bF)(l,{bordered:!1},{title:(0,a.k6)((()=>t[13]||(t[13]=[(0,a.Lk)("div",{class:"card-title"},[(0,a.Lk)("span",{class:"title"},"@员工后消息回复率"),(0,a.Lk)("span",{class:"desc"},"设置消息回复率后，群内成员的消息回复率将根据此处设置的时间进行统计")],-1)]))),default:(0,a.k6)((()=>[(0,a.bF)(i,{label:"消息回复率",style:{"margin-bottom":"0px"}},{default:(0,a.k6)((()=>[(0,a.Lk)("div",H,[(0,a.bF)(u,{value:p.at_msg_reply_sec,"onUpdate:value":t[0]||(t[0]=e=>p.at_msg_reply_sec=e),min:1,max:180,onChange:m},null,8,["value"]),t[14]||(t[14]=(0,a.Lk)("span",{class:"ml4"},"分钟",-1))]),t[15]||(t[15]=(0,a.Lk)("div",{class:"notice"}," 注意：消息回复率修改后，只会对修改后的数据生效，历史数据不生效，为防止数据出现误差，请谨慎操作 ",-1))])),_:1})])),_:1}),(0,a.bF)(l,{bordered:!1},{title:(0,a.k6)((()=>t[16]||(t[16]=[(0,a.Lk)("div",{class:"card-title"},[(0,a.Lk)("span",{class:"title"},"消息回复率"),(0,a.Lk)("span",{class:"desc"},"设置消息回复率后，群内成员的消息回复率将根据此处设置的时间进行统计")],-1)]))),default:(0,a.k6)((()=>[(0,a.bF)(i,{label:"消息回复率",style:{"margin-bottom":"0"}},{default:(0,a.k6)((()=>[(0,a.Lk)("div",N,[(0,a.bF)(u,{value:p.msg_reply_sec,"onUpdate:value":t[1]||(t[1]=e=>p.msg_reply_sec=e),min:1,max:180,onChange:m},null,8,["value"]),t[17]||(t[17]=(0,a.Lk)("span",{class:"ml4"},"分钟",-1))]),t[20]||(t[20]=(0,a.Lk)("div",{class:"notice"}," 注意：消息回复率修改后，只会对修改后的数据生效，历史数据不生效，为防止数据出现误差，请谨慎操作 ",-1)),(0,a.bF)(o,{class:"mt10",checked:p.other_effect,"onUpdate:checked":t[2]||(t[2]=e=>p.other_effect=e),onChange:m},{default:(0,a.k6)((()=>[(0,a.eW)(" 群内其他员工"+(0,s.v_)(p.msg_reply_sec||"-")+"分钟内回复了，也算作"+(0,s.v_)(p.msg_reply_sec||"-")+"分钟回复率 ",1)])),_:1},8,["checked"]),p.other_effect?((0,a.uX)(),(0,a.CE)("div",P,[(0,a.bF)(v,{value:p.group_staff_type,"onUpdate:value":t[3]||(t[3]=e=>p.group_staff_type=e),onChange:m},{default:(0,a.k6)((()=>[(0,a.bF)(g,{value:1},{default:(0,a.k6)((()=>t[18]||(t[18]=[(0,a.eW)("指定员工")]))),_:1}),(0,a.bF)(g,{value:2},{default:(0,a.k6)((()=>t[19]||(t[19]=[(0,a.eW)("全部群内员工")]))),_:1})])),_:1},8,["value"]),(0,a.Lk)("div",Q," 指定员工算作"+(0,s.v_)(p.msg_reply_sec||"-")+"分钟回复率，其他未设置的群内员工回复了，不计入。该设置仅对群内成员生效 ",1),1==p.group_staff_type?((0,a.uX)(),(0,a.CE)("div",D,[(0,a.bF)(U,{"selected-staffs":p.group_staff_info,onChange:_},null,8,["selected-staffs"])])):(0,a.Q3)("",!0)])):(0,a.Q3)("",!0)])),_:1})])),_:1}),(0,a.bF)(l,{bordered:!1},{title:(0,a.k6)((()=>t[21]||(t[21]=[(0,a.Lk)("div",{class:"card-title"},[(0,a.Lk)("span",{class:"title"},"群聊未回复规则"),(0,a.Lk)("span",{class:"desc"},"设置未回复规则后，群聊中未回复聊天数和未回复聊天占比将根据此规则进行统计")],-1)]))),default:(0,a.k6)((()=>[(0,a.Lk)("div",V,[(0,a.bF)(y,{type:"info","show-icon":!1,banner:"",message:"群聊时，客户发送的最后一句话成功匹配到关键词或消息类型匹配为选中类型，且员工没有回复，不算作未回复消息"}),(0,a.bF)(i,{label:"全匹配",class:"mt24"},{default:(0,a.k6)((()=>[(0,a.bF)(C,{placeholder:"请输入自定义匹配关键词","max-length":20,value:f.cst_keywords_full,"onUpdate:value":t[4]||(t[4]=e=>f.cst_keywords_full=e),onKeydown:t[5]||(t[5]=(0,n.jR)((e=>k("cst_keywords","full")),["enter"])),onBlur:t[6]||(t[6]=e=>k("cst_keywords","full")),style:{width:"360px"}},null,8,["value"]),(0,a.Lk)("div",M,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(p.cst_keywords.full,((e,t)=>((0,a.uX)(),(0,a.Wv)(F,{class:"zm-customize-tag",style:{margin:"8px 8px 0 0"},closable:"",onClose:e=>b("cst_keywords","full",t,e),key:t},{default:(0,a.k6)((()=>[(0,a.eW)((0,s.v_)(e),1)])),_:2},1032,["onClose"])))),128))])])),_:1}),(0,a.bF)(i,{label:"半匹配"},{default:(0,a.k6)((()=>[(0,a.bF)(C,{placeholder:"请输入自定义匹配关键词","max-length":20,value:f.cst_keywords_half,"onUpdate:value":t[7]||(t[7]=e=>f.cst_keywords_half=e),onKeydown:t[8]||(t[8]=(0,n.jR)((e=>k("cst_keywords","half")),["enter"])),onBlur:t[9]||(t[9]=e=>k("cst_keywords","half")),style:{width:"360px"}},null,8,["value"]),(0,a.Lk)("div",J,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(p.cst_keywords.half,((e,t)=>((0,a.uX)(),(0,a.Wv)(F,{class:"zm-customize-tag",style:{margin:"8px 8px 0 0"},closable:"",onClose:e=>b("cst_keywords","half",t,e),key:t},{default:(0,a.k6)((()=>[(0,a.eW)((0,s.v_)(e),1)])),_:2},1032,["onClose"])))),128))])])),_:1}),(0,a.bF)(i,{label:"消息类型",style:{"margin-bottom":"0"}},{default:(0,a.k6)((()=>[(0,a.bF)(x,{value:p.cst_keywords.msg_type_filter,"onUpdate:value":t[10]||(t[10]=e=>p.cst_keywords.msg_type_filter=e),onChange:m},{default:(0,a.k6)((()=>[(0,a.bF)(o,{value:"image"},{default:(0,a.k6)((()=>t[22]||(t[22]=[(0,a.eW)("图片")]))),_:1}),(0,a.bF)(o,{value:"emoji_preg"},{default:(0,a.k6)((()=>t[23]||(t[23]=[(0,a.eW)("emoji")]))),_:1}),(0,a.bF)(o,{value:"emotion"},{default:(0,a.k6)((()=>t[24]||(t[24]=[(0,a.eW)("表情包")]))),_:1})])),_:1},8,["value"])])),_:1}),(0,a.Lk)("div",Y,[(0,a.bF)(L,{onClick:h},{default:(0,a.k6)((()=>t[25]||(t[25]=[(0,a.eW)("取 消")]))),_:1}),(0,a.bF)(S,{open:c.value,"onUpdate:open":t[11]||(t[11]=e=>c.value=e),getPopupContainer:e=>e,overlayClassName:"zm-tip-popover",trigger:"manual",placement:"top",title:"提示"},{content:(0,a.k6)((()=>[t[27]||(t[27]=(0,a.Lk)("div",{class:"zm-nowrap"},"统计规则修改后需保存才可生效",-1)),(0,a.Lk)("div",$,[(0,a.bF)(L,{class:"save-btn",size:"small",onClick:(0,n.D$)(w,["stop"])},{default:(0,a.k6)((()=>t[26]||(t[26]=[(0,a.eW)("立即保存")]))),_:1})])])),default:(0,a.k6)((()=>[(0,a.bF)(L,{type:"primary",class:"ml16",onClick:w,loading:r.value},{default:(0,a.k6)((()=>t[28]||(t[28]=[(0,a.eW)("保 存")]))),_:1},8,["loading"])])),_:1},8,["open","getPopupContainer"])])])])),_:1})])])}}};const G=(0,S.A)(q,[["__scopeId","data-v-02683f6e"]]);var Z=G}}]);