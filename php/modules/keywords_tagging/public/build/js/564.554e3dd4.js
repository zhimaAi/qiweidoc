"use strict";(self["webpackChunkzmwk_session_archive"]=self["webpackChunkzmwk_session_archive"]||[]).push([[564],{3188:function(a,t,e){e.d(t,{A:function(){return F}});var s=e(6768),i=e(4232),n=e(144),l=e(4164),d=e(1387);const c={class:"statistic-box"},u={class:"statistic-item"},o={class:"statistic-content-box"},r={class:"statistic-content-item"},m={class:"statistic-content-item-info"},_={class:"statistic-content-item-info-num"},v={class:"statistic-item"},k={class:"statistic-content-box"},y={class:"statistic-content-item"},f={class:"statistic-content-item-info"},p={class:"statistic-content-item-info-num"},b={class:"statistic-item"},g={class:"statistic-content-box"},h={class:"statistic-content-item"},x={class:"statistic-content-item-info"},Y={class:"statistic-content-item-info-num"};var L={__name:"statistic",setup(a){const t=(0,d.lq)(),e=(0,n.KR)(!1),L=(0,n.Kh)({today_num:0,total_num:0,yesterday_num:0}),C=()=>{e.value=!0;let a={};t.query.task_id&&(a.task_id=t.query.task_id),(0,l.Hk)(a).then((a=>{L.today_num=a.data.today_num,L.total_num=a.data.total_num,L.yesterday_num=a.data.yesterday_num})).finally((()=>{e.value=!1}))};return(0,s.sV)((()=>{C()})),(a,t)=>((0,s.uX)(),(0,s.CE)("div",c,[(0,s.Lk)("div",u,[t[0]||(t[0]=(0,s.Lk)("div",{class:"statistic-item-title"},"打标签数",-1)),(0,s.Lk)("div",o,[(0,s.Lk)("div",r,[(0,s.Lk)("div",m,[(0,s.Lk)("div",_,(0,i.v_)(L.total_num),1)])])])]),(0,s.Lk)("div",v,[t[1]||(t[1]=(0,s.Lk)("div",{class:"statistic-item-title"},"今日打标签数",-1)),(0,s.Lk)("div",k,[(0,s.Lk)("div",y,[(0,s.Lk)("div",f,[(0,s.Lk)("div",p,(0,i.v_)(L.today_num),1)])])])]),(0,s.Lk)("div",b,[t[2]||(t[2]=(0,s.Lk)("div",{class:"statistic-item-title"},"昨日打标签数",-1)),(0,s.Lk)("div",g,[(0,s.Lk)("div",h,[(0,s.Lk)("div",x,[(0,s.Lk)("div",Y,(0,i.v_)(L.yesterday_num),1)])])])])]))}},C=e(1241);const w=(0,C.A)(L,[["__scopeId","data-v-29c33bd2"]]);var F=w},3846:function(a,t,e){e.r(t),e.d(t,{default:function(){return R}});var s=e(6768),i=e(144),n=e(1387),l=e(8292),d=e(4232),c=e(7694),u=e(1576),o=e.n(u),r=e(3188),m=e(706),_=e(4164),v=e(8298);const k={class:"zm-main-content"},y={class:"statistic-box"},f={class:"detail-header mt16"},p={class:"inline-block ml-8 mr-24 mb-8"},b={class:"inline-block"},g={key:0,class:"user-box"},h=["src"],x={class:"user-name"},Y={key:1,class:"msg-type-box"},L={class:"zm-line-clamp2",style:{"max-height":"40px"}},C={key:0,class:"msg-type-box"},w={class:"zm-line-clamp2",style:{"max-height":"40px"}},F={key:1,class:"msg-type-box"},M=["innerHTML"],D=["onClick"];var I={__name:"detail",setup(a){(0,n.rd)();const t=(0,n.lq)(),e=(0,i.KR)([{dataIndex:"external_name",title:"客户",width:180},{dataIndex:"staff_name",title:"所属员工",width:180},{dataIndex:"keyword",title:"最近触发关键词",width:222},{dataIndex:"msg_time",title:"提交时间",width:130},{dataIndex:"tag_info",title:"标签",width:120}]),l=(0,i.KR)([{label:"全部",value:"all"},{label:"今",value:"today"},{label:"昨",value:"yesterday"},{label:"自定义",value:"custom"}]),u=(0,i.Kh)({dateTab:"all",search_type:1}),I=(0,i.KR)(!1),K=(0,i.KR)([]),X=(0,i.Kh)({total:0,current:1,pageSize:10,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]}),z=(0,i.Kh)({customer_name:"",staff_userid:[],dates:[]}),E=(0,i.KR)([]),q=(0,i.KR)(null),T=a=>{a&&(E.value=a,z.staff_userid=a.map((a=>a.userid)),A())},A=()=>{K.value=[],X.current=1,X.total=0,W()},R=a=>a&&a>o()().endOf("day"),S=()=>{if(z.dates&&z.dates.length>0){let a=z.dates[1]-z.dates[0];a/864e5>30&&(z.dates=[],c.Ay.warning("发送时间跨度不得超过30天"))}A()},W=()=>{I.value=!0;let a={page:X.current,size:X.pageSize};z.customer_name=z.customer_name.trim(),z.customer_name?a.customer_name=z.customer_name:a.customer_name="",z.staff_userid?a.staff_userid=z.staff_userid[0]:a.staff_userid="",t.query.task_id?a.task_id=t.query.task_id:a.task_id="",z.dates&&z.dates.length&&(a.start_time=o()(z.dates[0]).format("YYYY-MM-DD 00:00:00"),a.end_time=o()(z.dates[1]).format("YYYY-MM-DD 23:59:59")),(0,_.eh)(a).then((a=>{K.value=a.data.items||[],X.total=Number(a.data?.total)})).finally((()=>{I.value=!1})).catch((a=>{}))},O=a=>{let t={};a.group_info?t.group_chat_id=a.group_info.chat_id:(t.conversation_id=a.conversation_id,t.sender=a.from_user_id,t.receiver=a.to_user_id||"",t.sender_type=a.from_role,t.receiver_type=a.to_role),window.open(`/#/sessionArchive/index?${(0,v.cX)(t)}`)},H=()=>{X.current=1,K.value=[],z.customer_name="",z.staff_userid=[],z.dates=[],u.dateTab="all",U()},U=()=>{switch(u.dateTab){case"all":z.dates=[];break;case"today":z.dates=[o()().startOf("day").format("YYYY-MM-DD"),o()().endOf("day").format("YYYY-MM-DD")];break;case"yesterday":z.dates=[o()().subtract(1,"day").startOf("day").format("YYYY-MM-DD"),o()().subtract(1,"day").endOf("day").format("YYYY-MM-DD")];break;default:break}return"custom"!==u.dateTab&&A()},V=a=>{X.current=a.current,X.pageSize=a.pageSize,W()},Q=()=>{W()};return(0,s.sV)((async()=>{t.query.date_type&&(1==t.query.date_type?(u.dateTab="today",U()):2==t.query.date_type?(u.dateTab="yesterday",U()):(u.dateTab="all",U())),t.query.date_type||await Q()})),(a,t)=>{const n=(0,s.g2)("a-input"),c=(0,s.g2)("a-form-item"),_=(0,s.g2)("a-col"),v=(0,s.g2)("a-radio-button"),E=(0,s.g2)("a-radio-group"),W=(0,s.g2)("a-range-picker"),Q=(0,s.g2)("a-button"),j=(0,s.g2)("a-row"),N=(0,s.g2)("a-form"),$=(0,s.g2)("a-table");return(0,s.uX)(),(0,s.CE)("div",k,[(0,s.Lk)("div",y,[(0,s.bF)(r.A)]),(0,s.Lk)("div",f,[(0,s.bF)(N,{model:u,name:"basic",autocomplete:"off"},{default:(0,s.k6)((()=>[(0,s.bF)(j,{type:"flex",justify:"space-around",align:"middle"},{default:(0,s.k6)((()=>[(0,s.bF)(_,{span:6,style:{"padding-right":"24px"}},{default:(0,s.k6)((()=>[(0,s.bF)(c,{label:"搜索客户"},{default:(0,s.k6)((()=>[(0,s.bF)(n,{value:z.customer_name,"onUpdate:value":t[0]||(t[0]=a=>z.customer_name=a),allowClear:"",placeholder:"请输入昵称搜索"},null,8,["value"])])),_:1})])),_:1}),(0,s.bF)(_,{span:18,style:{"padding-right":"24px"}},{default:(0,s.k6)((()=>[(0,s.bF)(c,{label:"提交时间"},{default:(0,s.k6)((()=>[(0,s.bF)(E,{value:u.dateTab,"onUpdate:value":t[1]||(t[1]=a=>u.dateTab=a),onChange:U},{default:(0,s.k6)((()=>[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.value,(a=>((0,s.uX)(),(0,s.Wv)(v,{value:a.value,key:a.value},{default:(0,s.k6)((()=>[(0,s.eW)((0,d.v_)(a.label),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"]),(0,s.Lk)("div",p,[(0,s.bF)(W,{value:z.dates,"onUpdate:value":t[2]||(t[2]=a=>z.dates=a),"value-format":"YYYY-MM-DD",class:"w-256",onChange:S,"disabled-date":R},null,8,["value"])]),(0,s.Lk)("div",b,[(0,s.bF)(Q,{onClick:A,type:"primary"},{default:(0,s.k6)((()=>t[4]||(t[4]=[(0,s.eW)("搜索")]))),_:1}),(0,s.bF)(Q,{onClick:H,class:"ml8"},{default:(0,s.k6)((()=>t[5]||(t[5]=[(0,s.eW)("重置")]))),_:1})])])),_:1})])),_:1})])),_:1})])),_:1},8,["model"])]),(0,s.bF)($,{class:"mt16 detail-table",loading:I.value,"data-source":K.value,columns:e.value,pagination:X,onChange:V},{bodyCell:(0,s.k6)((({column:a,text:e,record:n})=>["external_name"===a.dataIndex?((0,s.uX)(),(0,s.CE)("div",g,[(0,s.Lk)("img",{src:n.avatar,class:"avatar"},null,8,h),(0,s.Lk)("div",x,(0,d.v_)(e||"-"),1)])):"tag_info"===a.dataIndex?((0,s.uX)(),(0,s.CE)("div",Y,[(0,s.Lk)("div",L,(0,d.v_)(n.tag.name),1)])):"group_info"===a.dataIndex?((0,s.uX)(),(0,s.CE)(s.FK,{key:2},[e?((0,s.uX)(),(0,s.CE)("div",C,[(0,s.Lk)("div",w,(0,d.v_)(e.name||"-"),1)])):((0,s.uX)(),(0,s.CE)("div",F,t[6]||(t[6]=[(0,s.Lk)("div",{class:"zm-line-clamp2",style:{"max-height":"40px"}},"-",-1)])))],64)):"keyword"===a.dataIndex?((0,s.uX)(),(0,s.CE)("div",{key:3,innerHTML:e,class:"nodestr"},null,8,M)):"msg_time"===a.dataIndex?((0,s.uX)(),(0,s.CE)(s.FK,{key:4},[(0,s.eW)((0,d.v_)((0,i.R1)(o())(e).format("YYYY-MM-DD HH:mm:ss")),1)],64)):"operate"===a.dataIndex?((0,s.uX)(),(0,s.CE)("a",{key:5,class:"operate-content",onClick:a=>O(n)},"聊天明细",8,D)):(0,s.Q3)("",!0)])),_:1},8,["loading","data-source","columns","pagination"]),(0,s.bF)((0,i.R1)(m.A),{selectType:"single",ref_key:"setStaff",ref:q,onChange:t[3]||(t[3]=a=>T(a))},null,512)])}}},K=e(1241);const X=(0,K.A)(I,[["__scopeId","data-v-45a9409c"]]);var z=X,E=e(4686);const q={class:"sensitive-panel"};var T={__name:"details",setup(a){const t=(0,n.lq)(),e=t.query,d=((0,s.EW)((()=>t.meta.links||[])),(0,i.KR)(!1)),c=()=>{};return(0,s.sV)((()=>{e.task_id&&c()})),(a,t)=>((0,s.uX)(),(0,s.CE)("div",null,[(0,s.bF)(E.A,{title:[{name:"关键词打标签",route:"/module/keywords_tagging/index"},{name:"数据详情"}]}),(0,s.Lk)("div",q,[d.value?((0,s.uX)(),(0,s.Wv)(l.A,{key:0})):(0,s.Q3)("",!0),(0,s.bF)(z)])]))}};const A=(0,K.A)(T,[["__scopeId","data-v-f464d454"]]);var R=A}}]);