"use strict";(self["webpackChunkzmwk_session_archive"]=self["webpackChunkzmwk_session_archive"]||[]).push([[5],{62173:function(e,t,a){a.r(t),a.d(t,{default:function(){return A}});var n=a(56768),l=a(90144),i=a(24232),s=a.p+"img/data-empty.3486f0e2.png",o=a(81387),r=a(1576),d=a.n(r),u=a(57520),c=a(17694),m=a(79907),p=a(84164),_=a(8298);const v={class:"zm-main-content"},f={class:"mt16"},k={class:"zm-filter-box"},g={class:"zm-filter-item"},y={class:"zm-filter-item"},h={class:"zm-filter-item"},w={class:"zm-main-content mt16",style:{"min-height":"60vh"}},b=["innerHTML"],x={key:1,class:"zm-user-info"},z=["src"],C={class:"name"},L={key:0,class:"zm-user-info"},F=["src"],I={class:"name"},X={key:0},Y=["onClick"];var W={__name:"search",setup(e){const t=(0,o.rd)(),r=((0,o.lq)(),a(17767)),W=[{title:"会话内容",dataIndex:"msg_content",width:260},{title:"会话类型",dataIndex:"session_type_text",width:160},{title:"群聊名称",dataIndex:"group_info",width:160},{title:"发送人",dataIndex:"sender_info",width:160},{title:"接收人",dataIndex:"receiver_info",width:160},{title:"发送时间",dataIndex:"msg_time",width:160},{title:"操作",dataIndex:"id",width:120}],M=(e,t)=>{t.width=e},E=(0,l.KR)(!1),A=(0,l.KR)([]),D=(0,l.Kh)({pageSize:50,current:1,total:0}),K=(0,l.Kh)({keyword:"",session_type:void 0,from_type:0,dates:[],from:""}),R=()=>{A.value=[],D.current=1,D.total=0,H()},H=e=>{E.value=!0;let t={page:D.current,size:D.pageSize};K.keyword=K.keyword.trim(),K.from=K.from.trim(),K.keyword||e?(t.keyword=K.keyword,K.session_type&&(t.session_type=K.session_type),K.from&&(t.from=K.from,K.from_type>0&&(t.from_type=K.from_type)),K.dates.length&&(t.start_time=K.dates[0].format("YYYY-MM-DD 00:00:00"),t.stop_time=K.dates[1].format("YYYY-MM-DD 23:59:59")),e&&"init"==e&&(t.init=!0),(0,p.H)(t).then((e=>{let t=e.data||{},{items:a,total:n}=t;a.map((e=>{e.msg_content=e.msg_content.replace((0,_.sG)(K.keyword),`<span class="search-keyword-text">${K.keyword}</span>`),e.session_type_text=e.group_info?"群聊":"单聊",e.msg_time=d()(e.msg_time).format("YY/MM/DD HH:mm"),e.from_role=(0,_._C)(e.from_role)})),A.value=a,D.total=Number(n)})).finally((()=>{E.value=!1}))):c.Ay.warn("请输入搜索内容")},S=e=>{D.current=e.current,D.pageSize=e.pageSize,R()},U=()=>{if(K.dates.length>0){let e=K.dates[1]-K.dates[0];e/864e5>30&&(K.dates=[],c.Ay.warning("发送时间跨度不得超过30天"))}R()},Q=e=>{let a={};e.group_info?a.group_chat_id=e.roomid:(a.conversation_id=e.conversation_id,a.sender=e.from,a.receiver=e?.to_list[0]||"",a.sender_type=e.from_role,a.receiver_type=e.to_role);let n=t.resolve({path:"/sessionArchive/index",query:a}).href;window.open(n)},q=e=>e&&e>d()().endOf("day"),T=()=>{A.value=[],D.current=1,D.total=0,H("init")};return(0,n.sV)((()=>{T()})),(e,t)=>{const a=(0,n.g2)("a-alert"),o=(0,n.g2)("a-button"),d=(0,n.g2)("a-input-search"),c=(0,n.g2)("a-select-option"),p=(0,n.g2)("a-select"),_=(0,n.g2)("a-range-picker"),H=(0,n.g2)("a-input"),T=(0,n.g2)("a-input-group"),B=(0,n.g2)("a-table"),G=(0,n.g2)("a-empty");return(0,n.uX)(),(0,n.Wv)(m.A,{title:"会话搜索"},{default:(0,n.k6)((()=>[(0,n.Lk)("div",v,[(0,n.bF)(a,{"show-icon":"",message:"功能说明：支持通过关键词、单聊/群聊、会话时间等搜索条件查询会话内容"}),(0,n.Lk)("div",f,[(0,n.bF)(d,{value:K.keyword,"onUpdate:value":t[0]||(t[0]=e=>K.keyword=e),style:{width:"600px"},size:"large",placeholder:"请输入会话内容关键词搜索",allowClear:"",onSearch:R},{enterButton:(0,n.k6)((()=>[(0,n.bF)(o,{icon:(0,n.h)((0,l.R1)(u.A)),type:"primary"},{default:(0,n.k6)((()=>t[5]||(t[5]=[(0,n.eW)("搜 索")]))),_:1},8,["icon"])])),_:1},8,["value"])]),(0,n.Lk)("div",k,[(0,n.Lk)("div",g,[t[8]||(t[8]=(0,n.Lk)("span",{class:"zm-filter-label"},"会话类型：",-1)),(0,n.Lk)("div",null,[(0,n.bF)(p,{value:K.session_type,"onUpdate:value":t[1]||(t[1]=e=>K.session_type=e),style:{width:"220px"},onChange:R,placeholder:"请选择会话类型",allowClear:""},{default:(0,n.k6)((()=>[(0,n.bF)(c,{value:1},{default:(0,n.k6)((()=>t[6]||(t[6]=[(0,n.eW)("单聊")]))),_:1}),(0,n.bF)(c,{value:2},{default:(0,n.k6)((()=>t[7]||(t[7]=[(0,n.eW)("群聊")]))),_:1})])),_:1},8,["value"])])]),(0,n.Lk)("div",y,[t[9]||(t[9]=(0,n.Lk)("span",{class:"zm-filter-label"},"发送时间：",-1)),(0,n.Lk)("div",null,[(0,n.bF)(_,{value:K.dates,"onUpdate:value":t[2]||(t[2]=e=>K.dates=e),style:{width:"220px"},onChange:U,"disabled-date":q},null,8,["value"])])]),(0,n.Lk)("div",h,[t[13]||(t[13]=(0,n.Lk)("span",{class:"zm-filter-label"},"发送人：",-1)),(0,n.Lk)("div",null,[(0,n.bF)(T,{compact:""},{default:(0,n.k6)((()=>[(0,n.bF)(p,{value:K.from_type,"onUpdate:value":t[3]||(t[3]=e=>K.from_type=e),style:{width:"80px"},onChange:R,placeholder:"请选择会话类型"},{default:(0,n.k6)((()=>[(0,n.bF)(c,{value:0},{default:(0,n.k6)((()=>t[10]||(t[10]=[(0,n.eW)("全部")]))),_:1}),(0,n.bF)(c,{value:1},{default:(0,n.k6)((()=>t[11]||(t[11]=[(0,n.eW)("客户")]))),_:1}),(0,n.bF)(c,{value:2},{default:(0,n.k6)((()=>t[12]||(t[12]=[(0,n.eW)("员工")]))),_:1})])),_:1},8,["value"]),(0,n.bF)(H,{value:K.from,"onUpdate:value":t[4]||(t[4]=e=>K.from=e),style:{width:"220px"},placeholder:"选择输入发送人名称"},null,8,["value"])])),_:1})])])])]),(0,n.Lk)("div",w,[A.value.length>0?((0,n.uX)(),(0,n.Wv)(B,{key:0,loading:E.value,"data-source":A.value,columns:W,pagination:D,onResizeColumn:M,onChange:S},{bodyCell:(0,n.k6)((({column:e,text:t,record:a})=>["msg_content"===e.dataIndex?((0,n.uX)(),(0,n.CE)("div",{key:0,class:"msg-content-box",innerHTML:a.msg_content},null,8,b)):"sender_info"===e.dataIndex?((0,n.uX)(),(0,n.CE)("div",x,[(0,n.Lk)("img",{class:"avatar",src:a?.sender_info?.avatar||(0,l.R1)(r)},null,8,z),(0,n.Lk)("span",C,(0,i.v_)(a?.sender_info?.name),1)])):"receiver_info"===e.dataIndex?((0,n.uX)(),(0,n.CE)(n.FK,{key:2},[a?.receiver_info?((0,n.uX)(),(0,n.CE)("div",L,[(0,n.Lk)("img",{class:"avatar",src:a?.receiver_info?.avatar||(0,l.R1)(r)},null,8,F),(0,n.Lk)("span",I,(0,i.v_)(a?.receiver_info?.name),1)])):(0,n.Q3)("",!0)],64)):"group_info"===e.dataIndex?((0,n.uX)(),(0,n.CE)(n.FK,{key:3},[a.group_info?((0,n.uX)(),(0,n.CE)("div",X,(0,i.v_)(a.group_info?.group_name||"未命名群聊"),1)):(0,n.Q3)("",!0)],64)):"id"===e.dataIndex?((0,n.uX)(),(0,n.CE)("a",{key:4,onClick:e=>Q(a)},"查看明细",8,Y)):(0,n.Q3)("",!0)])),_:1},8,["loading","data-source","pagination"])):((0,n.uX)(),(0,n.Wv)(G,{key:1,style:{"margin-top":"88px"},description:K.keyword?"暂无匹配数据":"输入内容后搜索查看"},{image:(0,n.k6)((()=>t[14]||(t[14]=[(0,n.Lk)("img",{src:s},null,-1)]))),_:1},8,["description"]))])])),_:1})}}},M=a(71241);const E=(0,M.A)(W,[["__scopeId","data-v-773c8269"]]);var A=E}}]);