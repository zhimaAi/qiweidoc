{"version":3,"file":"js/609.423e9152.js","mappings":"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","sources":["webpack://zmwk_session_archive/./src/api/session.js","webpack://zmwk_session_archive/./src/views/sessionArchive/search.vue","webpack://zmwk_session_archive/./src/views/sessionArchive/search.vue?0b35"],"sourcesContent":["import request from \"@/api/request\";\n\nexport const staffCstSessions = data => {\n    return request.get(\"/api/chats/by/staff/customer/conversation/list\", {params: data})\n}\n\nexport const staffSessions = data => {\n    return request.get('/api/chats/by/staff/staff/conversation/list', {params: data})\n}\n\nexport const groupSessions = data => {\n    return request.get('/api/chats/by/staff/room/conversation/list', {params: data})\n}\n\nexport const cstSessions = data => {\n    return request.get('/api/chats/by/customer/staff/conversation/list', {params: data})\n}\n\nexport const sessionMessage = data => {\n    return request.get('/api/chats/by/conversation/message/list', {params: data})\n}\n\nexport const groupMessage = data => {\n    return request.get('/api/chats/by/group/message/list', {params: data})\n}\n\nexport const searchSession = data => {\n    return request.get('/api/chats/search', {params: data})\n}\n","<template>\n    <MainLayout title=\"会话搜索\">\n        <div class=\"zm-main-content\">\n            <a-alert show-icon message=\"功能说明：支持通过关键词、单聊/群聊、会话时间等搜索条件查询会话内容\"></a-alert>\n            <div class=\"mt16\">\n                <a-input-search\n                    v-model:value=\"filterData.keyword\"\n                    style=\"width: 600px;\"\n                    size=\"large\"\n                    placeholder=\"请输入会话内容关键词搜索\"\n                    allowClear\n                    @search=\"search\">\n                    <template #enterButton>\n                        <a-button :icon=\"h(SearchOutlined)\" type=\"primary\">搜 索</a-button>\n                    </template>\n                </a-input-search>\n            </div>\n            <div class=\"zm-filter-box\">\n                <div class=\"zm-filter-item\">\n                    <span class=\"zm-filter-label\">会话类型：</span>\n                    <div>\n                        <a-select v-model:value=\"filterData.session_type\"\n                                  style=\"width: 220px;\"\n                                  @change=\"search\"\n                                  placeholder=\"请选择会话类型\"\n                                  allowClear>\n                            <a-select-option :value=\"1\">单聊</a-select-option>\n                            <a-select-option :value=\"2\">群聊</a-select-option>\n                        </a-select>\n                    </div>\n                </div>\n                <div class=\"zm-filter-item\">\n                    <span class=\"zm-filter-label\">发送时间：</span>\n                    <div>\n                        <a-range-picker\n                            v-model:value=\"filterData.dates\"\n                            style=\"width: 220px;\"\n                            @change=\"filterDateChange\"\n                            :disabled-date=\"disabledDate\"/>\n                    </div>\n                </div>\n                <div class=\"zm-filter-item\">\n                    <span class=\"zm-filter-label\">发送人：</span>\n                    <div>\n                        <a-input-group compact>\n                            <a-select\n                                v-model:value=\"filterData.from_type\"\n                                style=\"width: 80px;\"\n                                @change=\"search\"\n                                placeholder=\"请选择会话类型\"\n                            >\n                                <a-select-option :value=\"0\">全部</a-select-option>\n                                <a-select-option :value=\"1\">客户</a-select-option>\n                                <a-select-option :value=\"2\">员工</a-select-option>\n                            </a-select>\n                            <a-input v-model:value=\"filterData.from\"\n                                     style=\"width: 220px;\"\n                                     placeholder=\"选择输入发送人名称\"/>\n                        </a-input-group>\n                    </div>\n                </div>\n                <!--                <div class=\"zm-filter-item\">-->\n                <!--                    <span class=\"zm-filter-label\">发送群聊：</span>-->\n                <!--                    <div>-->\n                <!--                        <a-input v-model:value=\"filterData.group\"-->\n                <!--                                 style=\"width: 220px;\"-->\n                <!--                                 placeholder=\"选择输入群聊名称\"/>-->\n                <!--                    </div>-->\n                <!--                </div>-->\n            </div>\n        </div>\n        <div class=\"zm-main-content mt16\" style=\"min-height: 60vh;\">\n            <a-table\n                v-if=\"list.length > 0\"\n                :loading=\"loading\"\n                :data-source=\"list\"\n                :columns=\"columns\"\n                :pagination=\"pagination\"\n                @resizeColumn=\"handleResizeColumn\"\n                @change=\"tableChange\"\n            >\n                <template #bodyCell=\"{column, text, record}\">\n                    <template v-if=\"column.dataIndex === 'msg_content'\">\n                        <div class=\"msg-content-box\" v-html=\"record.msg_content\"></div>\n                    </template>\n                    <template v-else-if=\"column.dataIndex === 'sender_info'\">\n                        <div class=\"zm-user-info\">\n                            <img class=\"avatar\" :src=\"record?.sender_info?.avatar || defaultAvatar\"/>\n                            <span class=\"name\">{{ record?.sender_info?.name }}</span>\n                        </div>\n                    </template>\n                    <template v-else-if=\"column.dataIndex === 'receiver_info'\">\n                        <div v-if=\"record?.receiver_info\" class=\"zm-user-info\">\n                            <img class=\"avatar\" :src=\"record?.receiver_info?.avatar || defaultAvatar\"/>\n                            <span class=\"name\">{{ record?.receiver_info?.name }}</span>\n                        </div>\n                    </template>\n                    <template v-else-if=\"column.dataIndex === 'group_info'\">\n                        <div v-if=\"record.group_info\">\n                            {{ record.group_info?.group_name || '未命名群聊' }}\n                        </div>\n                    </template>\n                    <template v-else-if=\"column.dataIndex === 'id'\">\n                        <a @click=\"openDetail(record)\">查看明细</a>\n                    </template>\n                </template>\n            </a-table>\n            <a-empty v-else\n                     style=\"margin-top: 88px;\"\n                     :description=\"filterData.keyword ? '暂无匹配数据' : '输入内容后搜索查看'\">\n                <template #image>\n                    <img src=\"@/assets/image/data-empty.png\"/>\n                </template>\n            </a-empty>\n        </div>\n    </MainLayout>\n</template>\n\n<script setup>\nimport {h, reactive, ref} from 'vue';\nimport {useRoute, useRouter} from 'vue-router';\nimport dayjs from 'dayjs';\nimport {SearchOutlined} from '@ant-design/icons-vue';\nimport {message} from 'ant-design-vue';\nimport MainLayout from \"@/components/mainLayout.vue\";\nimport {searchSession} from \"@/api/session\";\nimport {getRegex} from \"@/utils/tools\";\n\nconst router = useRouter()\nconst route = useRoute()\nconst defaultAvatar = require('@/assets/default-avatar.png');\nconst columns = [\n    {\n        title: \"会话内容\",\n        dataIndex: \"msg_content\",\n        width: 260,\n    },\n    {\n        title: \"会话类型\",\n        dataIndex: \"session_type_text\",\n        width: 160,\n    },\n    {\n        title: \"群聊名称\",\n        dataIndex: \"group_info\",\n        width: 160,\n    },\n    {\n        title: \"发送人\",\n        dataIndex: \"sender_info\",\n        width: 160,\n    },\n    {\n        title: \"接收人\",\n        dataIndex: \"receiver_info\",\n        width: 160,\n    },\n    {\n        title: \"发送时间\",\n        dataIndex: \"msg_time\",\n        width: 160,\n    },\n    {\n        title: \"操作\",\n        dataIndex: \"id\",\n        width: 120,\n    }\n]\nconst handleResizeColumn = (w, col) => {\n    col.width = w;\n}\nconst loading = ref(false)\nconst list = ref([])\nconst pagination = reactive({\n    pageSize: 50,\n    current: 1,\n    total: 0\n})\nconst filterData = reactive({\n    keyword: '',\n    session_type: undefined,\n    from_type: 0,\n    dates: [],\n    from: '',\n})\n\nconst search = () => {\n    list.value = []\n    pagination.current = 1\n    pagination.total = 0\n    loadData()\n}\n\nconst loadData = () => {\n    loading.value = true\n    let params = {\n        page: pagination.current,\n        size: pagination.pageSize\n    }\n    filterData.keyword = filterData.keyword.trim()\n    filterData.from = filterData.from.trim()\n    if (!filterData.keyword) {\n        message.warn('请输入搜索内容')\n        return\n    }\n    params.keyword = filterData.keyword\n    if (filterData.session_type) {\n        params.session_type = filterData.session_type\n    }\n    if (filterData.from) {\n        params.from = filterData.from\n        if (filterData.from_type > 0) {\n            params.from_type = filterData.from_type\n        }\n    }\n    if (filterData.dates.length) {\n        params.start_time = filterData.dates[0].format('YYYY-MM-DD 00:00:01')\n        params.stop_time = filterData.dates[1].format('YYYY-MM-DD 23:59:59')\n    }\n    searchSession(params).then(res => {\n        let data = res.data || {}\n        let {items, total} = data\n        items.map(item => {\n            item.msg_content = item.msg_content.replace(getRegex(filterData.keyword), `<span class=\"search-keyword-text\">${filterData.keyword}</span>`)\n            item.session_type_text = item.group_info ? '群聊' : '单聊'\n            item.msg_time = dayjs(item.msg_time).format('YY/MM/DD HH:mm')\n        })\n        list.value = items\n        pagination.total = Number(total)\n    }).finally(() => {\n        loading.value = false\n    })\n}\n\nconst tableChange = p => {\n    pagination.current = p.current\n    pagination.pageSize = p.pageSize\n    search()\n}\n\nconst filterDateChange = () => {\n    if (filterData.dates.length > 0) {\n        let time = filterData.dates[1] - filterData.dates[0]\n        if ((time / 86400000) > 30) {\n            filterData.dates = []\n            message.warning(\"发送时间跨度不得超过30天\")\n        }\n    }\n    search()\n}\n\nconst openDetail = record => {\n    let params = {}\n    if (record.group_info) {\n        params.group_chat_id = record.roomid\n    } else {\n        params.conversation_id = record.conversation_id\n        params.sender = record.from\n        params.receiver = record?.to_list[0] || ''\n        params.sender_type = record.from_role\n        params.receiver_type = record.to_role\n    }\n    let href = router.resolve({\n        path: '/sessionArchive/index',\n        query: params\n    }).href\n    window.open(href)\n}\n\nconst disabledDate = current => {\n    return current && current > dayjs().endOf('day')\n}\n</script>\n\n<style scoped lang=\"less\">\n.zm-filter-box {\n    flex-wrap: wrap;\n\n    .zm-filter-item {\n        margin-top: 12px;\n        margin-right: 12px;\n    }\n}\n\n.zm-main-content {\n    :deep(.ant-empty-image) {\n        height: 200px;\n        margin-bottom: 0;\n    }\n\n    :deep(.msg-content-box) {\n        word-break: break-all;\n        .search-keyword-text {\n            color: red;\n        }\n    }\n}\n</style>\n","import script from \"./search.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./search.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./search.vue?vue&type=style&index=0&id=4eab6876&scoped=true&lang=less\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-4eab6876\"]])\n\nexport default __exports__"],"names":["staffCstSessions","data","request","get","params","staffSessions","groupSessions","cstSessions","sessionMessage","groupMessage","searchSession","router","useRouter","defaultAvatar","useRoute","require","columns","title","dataIndex","width","handleResizeColumn","w","col","loading","ref","list","pagination","reactive","pageSize","current","total","filterData","keyword","session_type","undefined","from_type","dates","from","search","value","loadData","page","size","trim","length","start_time","format","stop_time","then","res","items","map","item","msg_content","replace","getRegex","session_type_text","group_info","msg_time","dayjs","Number","finally","message","warn","tableChange","p","filterDateChange","time","warning","openDetail","record","group_chat_id","roomid","conversation_id","sender","receiver","to_list","sender_type","from_role","receiver_type","to_role","href","resolve","path","query","window","open","disabledDate","endOf","__exports__"],"sourceRoot":""}