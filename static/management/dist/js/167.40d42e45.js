"use strict";(self["webpackChunkzmwk_session_archive"]=self["webpackChunkzmwk_session_archive"]||[]).push([[167],{2041:function(e,t,a){a.d(t,{A:function(){return o}});var n=a(6768),l={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M168 504.2c1-43.7 10-86.1 26.9-126 17.3-41 42.1-77.7 73.7-109.4S337 212.3 378 195c42.4-17.9 87.4-27 133.9-27s91.5 9.1 133.8 27A341.5 341.5 0 01755 268.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.7 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c0-6.7-7.7-10.5-12.9-6.3l-56.4 44.1C765.8 155.1 646.2 92 511.8 92 282.7 92 96.3 275.6 92 503.8a8 8 0 008 8.2h60c4.4 0 7.9-3.5 8-7.8zm756 7.8h-60c-4.4 0-7.9 3.5-8 7.8-1 43.7-10 86.1-26.9 126-17.3 41-42.1 77.8-73.7 109.4A342.45 342.45 0 01512.1 856a342.24 342.24 0 01-243.2-100.8c-9.9-9.9-19.2-20.4-27.8-31.4l60.2-47a8 8 0 00-3-14.1l-175.7-43c-5-1.2-9.9 2.6-9.9 7.7l-.7 181c0 6.7 7.7 10.5 12.9 6.3l56.4-44.1C258.2 868.9 377.8 932 512.2 932c229.2 0 415.5-183.7 419.8-411.8a8 8 0 00-8-8.2z"}}]},name:"sync",theme:"outlined"},r=l,c=a(4827);function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?Object(arguments[t]):{},n=Object.keys(a);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),n.forEach((function(t){s(e,t,a[t])}))}return e}function s(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var u=function(e,t){var a=i({},e,t.attrs);return(0,n.bF)(c.A,i({},a,{icon:r}),null)};u.displayName="SyncOutlined",u.inheritAttrs=!1;var o=u},7875:function(e,t,a){a.d(t,{HN:function(){return i},LB:function(){return o},RJ:function(){return r},Xj:function(){return c},aN:function(){return l},kc:function(){return s},s6:function(){return u}});var n=a(7277);const l=()=>n.A.get("/api/department/sync"),r=()=>n.A.get("/api/department/list"),c=e=>n.A.get("/api/staff/list",{params:e}),i=e=>n.A.get("/api/groups/list",{params:e}),s=e=>n.A.get("/api/groups/sync",{params:e}),u=e=>n.A.get("/api/customers/list",{params:e}),o=e=>n.A.get("/api/customers/sync",{params:e})},879:function(e,t,a){a.r(t),a.d(t,{default:function(){return S}});var n=a(6768),l=a(144),r=a(4232),c=a(7767),i=a(1576),s=a.n(i),u=a(7694),o=a(2041),d=a(1745),p=a(7875),v={__name:"staffDepartmentStruct",emits:["change"],setup(e,{emit:t}){const a=t,r=(0,l.KR)([]),c=(0,l.KR)([]);(0,n.sV)((()=>{i()}));const i=()=>{(0,p.RJ)().then((e=>{let t=e.data||[];t=t.map((e=>s(e))),r.value=t}))},s=(e,t=0)=>{let a=`${t}-${e.department_id}`;return e?.child_node?.length>0&&(e.children=e.child_node.map((e=>s(e,a)))),{key:a,title:e.name,children:e.children}},u=()=>{a("change",c.value)};return(e,t)=>{const a=(0,n.g2)("a-tree");return(0,n.uX)(),(0,n.Wv)(a,{"selected-keys":c.value,"onUpdate:selectedKeys":t[0]||(t[0]=e=>c.value=e),onSelect:u,"block-node":"",showLine:"","tree-data":r.value},null,8,["selected-keys","tree-data"])}}};const m=v;var f=m,k=a(5067);const g={class:"container"},y={class:"left-block"},h={class:"header-box"},_={class:"operate-box"},b={class:"zm-flex-between mt8"},w={class:"zm-filter-box"},z={class:"zm-filter-item"},A={key:0,class:"zm-user-info"},C={class:"name"},K={class:"right-block ml16"};var L={__name:"staff",setup(e){const t=[{dataIndex:"name",title:"员工",width:150},{dataIndex:"cst_total",width:90,title:"客户总数"},{dataIndex:"department_name",width:140,title:"所属部门"},{dataIndex:"tag_name",width:135,title:"员工标签"}],a=(0,l.KR)(!1),i=(0,l.KR)(!1),v=(0,l.KR)(1),m=(0,l.KR)([]),L=(0,l.Kh)({total:0,current:1,pageSize:10,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]}),X=(0,l.Kh)({keyword:"",auth_status:"",department_id:""});(0,n.sV)((()=>{x(),F()}));const x=()=>{(0,k.Jt)("zm:sync:staff:last:day")!=s()().format("YYYYMMDD")&&(S(),(0,k.hZ)("zm:sync:staff:last:day",s()().format("YYYYMMDD")))},S=()=>{const e=u.Ay.loading("正在同步");i.value=!0,(0,p.aN)().then((e=>{u.Ay.success("同步完成")})).finally((()=>{e(),i.value=!1}))},O=()=>{m.value=[],L.total=1,L.current=1,F()},F=()=>{a.value=!0;let e={page:L.current,size:L.pageSize};X.keyword=X.keyword.trim(),X.keyword&&(e.keyword=X.keyword),X.department_id&&(e.department_id=X.department_id),(0,p.Xj)(e).then((e=>{m.value=e.data.items||[],L.total=Number(e.data.total)})).finally((()=>{a.value=!1}))},I=e=>{L.current=e.current,L.pageSize=e.pageSize,F()},W=e=>{let t=e[0]||null;if(t){let e=t.split("-");X.department_id=e.slice(-1)[0]}O()};return(e,s)=>{const u=(0,n.g2)("a-button"),p=(0,n.g2)("a-input-search"),k=(0,n.g2)("a-tag"),x=(0,n.g2)("a-popover"),F=(0,n.g2)("a-table"),R=(0,n.g2)("a-tab-pane"),j=(0,n.g2)("a-tabs");return(0,n.uX)(),(0,n.Wv)(d.A,{title:"员工管理"},{default:(0,n.k6)((()=>[(0,n.Lk)("div",g,[(0,n.Lk)("div",y,[(0,n.Lk)("div",h,[(0,n.Lk)("div",_,[(0,n.bF)(u,{type:"primary",loading:i.value,icon:(0,n.h)((0,l.R1)(o.A)),onClick:S},{default:(0,n.k6)((()=>s[2]||(s[2]=[(0,n.eW)("同步员工和部门")]))),_:1},8,["loading","icon"])]),(0,n.Lk)("div",b,[(0,n.Lk)("div",null,[s[3]||(s[3]=(0,n.eW)("总员工数：")),(0,n.Lk)("strong",null,(0,r.v_)(L.total),1)]),(0,n.Lk)("div",w,[(0,n.Lk)("div",z,[s[4]||(s[4]=(0,n.Lk)("div",{class:"zm-filter-label"},"搜索员工：",-1)),(0,n.bF)(p,{style:{width:"200px"},placeholder:"请输入昵称或别名搜索",value:X.keyword,"onUpdate:value":s[0]||(s[0]=e=>X.keyword=e),allowClear:"",onSearch:O},null,8,["value"])])])])]),(0,n.bF)(F,{class:"mt16",loading:a.value,"data-source":m.value,columns:t,pagination:L,onChange:I},{bodyCell:(0,n.k6)((({column:e,text:t,record:a})=>["name"===e.dataIndex?((0,n.uX)(),(0,n.CE)("div",A,[s[5]||(s[5]=(0,n.Lk)("img",{class:"avatar",src:c},null,-1)),(0,n.Lk)("span",C,(0,r.v_)(a.name),1)])):"tag_name"===e.dataIndex?((0,n.uX)(),(0,n.CE)(n.FK,{key:1},[t?.length>3?((0,n.uX)(),(0,n.Wv)(x,{key:0},{content:(0,n.k6)((()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(t,((e,t)=>((0,n.uX)(),(0,n.CE)("div",{key:t},(0,r.v_)(e),1)))),128))])),default:(0,n.k6)((()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(t.slice(0,3),((e,t)=>((0,n.uX)(),(0,n.Wv)(k,{key:t},{default:(0,n.k6)((()=>[(0,n.eW)((0,r.v_)(e),1)])),_:2},1024)))),128)),(0,n.Lk)("span",null,"+"+(0,r.v_)(t.length-3),1)])),_:2},1024)):((0,n.uX)(!0),(0,n.CE)(n.FK,{key:1},(0,n.pI)(t,((e,t)=>((0,n.uX)(),(0,n.Wv)(k,{key:t},{default:(0,n.k6)((()=>[(0,n.eW)((0,r.v_)(e),1)])),_:2},1024)))),128))],64)):(0,n.Q3)("",!0)])),_:1},8,["loading","data-source","pagination"])]),(0,n.Lk)("div",K,[(0,n.bF)(j,{activeKey:v.value,"onUpdate:activeKey":s[1]||(s[1]=e=>v.value=e)},{default:(0,n.k6)((()=>[((0,n.uX)(),(0,n.Wv)(R,{key:1,tab:"组织架构"},{default:(0,n.k6)((()=>[(0,n.bF)(f,{onChange:W})])),_:1}))])),_:1},8,["activeKey"])])])])),_:1})}}},X=a(1241);const x=(0,X.A)(L,[["__scopeId","data-v-3e991eac"]]);var S=x}}]);
//# sourceMappingURL=167.40d42e45.js.map