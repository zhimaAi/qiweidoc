"use strict";(self["webpackChunkzmwk_session_archive"]=self["webpackChunkzmwk_session_archive"]||[]).push([[636],{4164:function(e,t,a){a.d(t,{H:function(){return c},Ln:function(){return i},MV:function(){return s},Zz:function(){return u},gf:function(){return o},no:function(){return d},un:function(){return l},wN:function(){return r}});var n=a(7277);const s=e=>n.A.get("/api/chats/by/staff/customer/conversation/list",{params:e}),r=e=>n.A.get("/api/chats/by/staff/staff/conversation/list",{params:e}),i=e=>n.A.get("/api/chats/by/staff/room/conversation/list",{params:e}),o=e=>n.A.get("/api/chats/by/customer/staff/conversation/list",{params:e}),l=e=>n.A.get("/api/chats/by/conversation/message/list",{params:e}),d=e=>n.A.get("/api/chats/by/group/message/list",{params:e}),u=e=>n.A.get("/api/customers/has-conversation/list",{params:e}),c=e=>n.A.get("/api/chats/search",{params:e})},7265:function(e,t,a){a.r(t),a.d(t,{default:function(){return E}});var n=a(6768),s=a(144),r=a(4232),i=a.p+"img/data-empty.3486f0e2.png",o=a(1387),l=a(1576),d=a.n(l),u=a(7520),c=a(7694),m=a(1745),p=a(4164),f=a(8298);const v={class:"zm-main-content"},_={class:"mt16"},g={class:"zm-filter-box"},k={class:"zm-filter-item"},y={class:"zm-filter-item"},h={class:"zm-filter-item"},w={class:"zm-main-content mt16",style:{"min-height":"60vh"}},b=["innerHTML"],x={key:1,class:"zm-user-info"},z=["src"],L={class:"name"},C={key:0,class:"zm-user-info"},F=["src"],A={class:"name"},I={key:0},X=["onClick"];var Y={__name:"search",setup(e){const t=(0,o.rd)(),l=((0,o.lq)(),a(7767)),Y=[{title:"会话内容",dataIndex:"msg_content",width:260},{title:"会话类型",dataIndex:"session_type_text",width:160},{title:"群聊名称",dataIndex:"group_info",width:160},{title:"发送人",dataIndex:"sender_info",width:160},{title:"接收人",dataIndex:"receiver_info",width:160},{title:"发送时间",dataIndex:"msg_time",width:160},{title:"操作",dataIndex:"id",width:120}],M=(e,t)=>{t.width=e},W=(0,s.KR)(!1),E=(0,s.KR)([]),D=(0,s.Kh)({pageSize:50,current:1,total:0}),H=(0,s.Kh)({keyword:"",session_type:void 0,from_type:0,dates:[],from:""}),K=()=>{E.value=[],D.current=1,D.total=0,R()},R=()=>{W.value=!0;let e={page:D.current,size:D.pageSize};H.keyword=H.keyword.trim(),H.from=H.from.trim(),H.keyword?(e.keyword=H.keyword,H.session_type&&(e.session_type=H.session_type),H.from&&(e.from=H.from,H.from_type>0&&(e.from_type=H.from_type)),H.dates.length&&(e.start_time=H.dates[0].format("YYYY-MM-DD 00:00:01"),e.stop_time=H.dates[1].format("YYYY-MM-DD 23:59:59")),(0,p.H)(e).then((e=>{let t=e.data||{},{items:a,total:n}=t;a.map((e=>{e.msg_content=e.msg_content.replace((0,f.sG)(H.keyword),`<span class="search-keyword-text">${H.keyword}</span>`),e.session_type_text=e.group_info?"群聊":"单聊",e.msg_time=d()(e.msg_time).format("YY/MM/DD HH:mm")})),E.value=a,D.total=Number(n)})).finally((()=>{W.value=!1}))):c.Ay.warn("请输入搜索内容")},S=e=>{D.current=e.current,D.pageSize=e.pageSize,K()},U=()=>{if(H.dates.length>0){let e=H.dates[1]-H.dates[0];e/864e5>30&&(H.dates=[],c.Ay.warning("发送时间跨度不得超过30天"))}K()},Q=e=>{let a={};e.group_info?a.group_chat_id=e.roomid:(a.conversation_id=e.conversation_id,a.sender=e.from,a.receiver=e?.to_list[0]||"",a.sender_type=e.from_role,a.receiver_type=e.to_role);let n=t.resolve({path:"/sessionArchive/index",query:a}).href;window.open(n)},q=e=>e&&e>d()().endOf("day");return(e,t)=>{const a=(0,n.g2)("a-alert"),o=(0,n.g2)("a-button"),d=(0,n.g2)("a-input-search"),c=(0,n.g2)("a-select-option"),p=(0,n.g2)("a-select"),f=(0,n.g2)("a-range-picker"),R=(0,n.g2)("a-input"),N=(0,n.g2)("a-input-group"),T=(0,n.g2)("a-table"),B=(0,n.g2)("a-empty");return(0,n.uX)(),(0,n.Wv)(m.A,{title:"会话搜索"},{default:(0,n.k6)((()=>[(0,n.Lk)("div",v,[(0,n.bF)(a,{"show-icon":"",message:"功能说明：支持通过关键词、单聊/群聊、会话时间等搜索条件查询会话内容"}),(0,n.Lk)("div",_,[(0,n.bF)(d,{value:H.keyword,"onUpdate:value":t[0]||(t[0]=e=>H.keyword=e),style:{width:"600px"},size:"large",placeholder:"请输入会话内容关键词搜索",allowClear:"",onSearch:K},{enterButton:(0,n.k6)((()=>[(0,n.bF)(o,{icon:(0,n.h)((0,s.R1)(u.A)),type:"primary"},{default:(0,n.k6)((()=>t[5]||(t[5]=[(0,n.eW)("搜 索")]))),_:1},8,["icon"])])),_:1},8,["value"])]),(0,n.Lk)("div",g,[(0,n.Lk)("div",k,[t[8]||(t[8]=(0,n.Lk)("span",{class:"zm-filter-label"},"会话类型：",-1)),(0,n.Lk)("div",null,[(0,n.bF)(p,{value:H.session_type,"onUpdate:value":t[1]||(t[1]=e=>H.session_type=e),style:{width:"220px"},onChange:K,placeholder:"请选择会话类型",allowClear:""},{default:(0,n.k6)((()=>[(0,n.bF)(c,{value:1},{default:(0,n.k6)((()=>t[6]||(t[6]=[(0,n.eW)("单聊")]))),_:1}),(0,n.bF)(c,{value:2},{default:(0,n.k6)((()=>t[7]||(t[7]=[(0,n.eW)("群聊")]))),_:1})])),_:1},8,["value"])])]),(0,n.Lk)("div",y,[t[9]||(t[9]=(0,n.Lk)("span",{class:"zm-filter-label"},"发送时间：",-1)),(0,n.Lk)("div",null,[(0,n.bF)(f,{value:H.dates,"onUpdate:value":t[2]||(t[2]=e=>H.dates=e),style:{width:"220px"},onChange:U,"disabled-date":q},null,8,["value"])])]),(0,n.Lk)("div",h,[t[13]||(t[13]=(0,n.Lk)("span",{class:"zm-filter-label"},"发送人：",-1)),(0,n.Lk)("div",null,[(0,n.bF)(N,{compact:""},{default:(0,n.k6)((()=>[(0,n.bF)(p,{value:H.from_type,"onUpdate:value":t[3]||(t[3]=e=>H.from_type=e),style:{width:"80px"},onChange:K,placeholder:"请选择会话类型"},{default:(0,n.k6)((()=>[(0,n.bF)(c,{value:0},{default:(0,n.k6)((()=>t[10]||(t[10]=[(0,n.eW)("全部")]))),_:1}),(0,n.bF)(c,{value:1},{default:(0,n.k6)((()=>t[11]||(t[11]=[(0,n.eW)("客户")]))),_:1}),(0,n.bF)(c,{value:2},{default:(0,n.k6)((()=>t[12]||(t[12]=[(0,n.eW)("员工")]))),_:1})])),_:1},8,["value"]),(0,n.bF)(R,{value:H.from,"onUpdate:value":t[4]||(t[4]=e=>H.from=e),style:{width:"220px"},placeholder:"选择输入发送人名称"},null,8,["value"])])),_:1})])])])]),(0,n.Lk)("div",w,[E.value.length>0?((0,n.uX)(),(0,n.Wv)(T,{key:0,loading:W.value,"data-source":E.value,columns:Y,pagination:D,onResizeColumn:M,onChange:S},{bodyCell:(0,n.k6)((({column:e,text:t,record:a})=>["msg_content"===e.dataIndex?((0,n.uX)(),(0,n.CE)("div",{key:0,class:"msg-content-box",innerHTML:a.msg_content},null,8,b)):"sender_info"===e.dataIndex?((0,n.uX)(),(0,n.CE)("div",x,[(0,n.Lk)("img",{class:"avatar",src:a?.sender_info?.avatar||(0,s.R1)(l)},null,8,z),(0,n.Lk)("span",L,(0,r.v_)(a?.sender_info?.name),1)])):"receiver_info"===e.dataIndex?((0,n.uX)(),(0,n.CE)(n.FK,{key:2},[a?.receiver_info?((0,n.uX)(),(0,n.CE)("div",C,[(0,n.Lk)("img",{class:"avatar",src:a?.receiver_info?.avatar||(0,s.R1)(l)},null,8,F),(0,n.Lk)("span",A,(0,r.v_)(a?.receiver_info?.name),1)])):(0,n.Q3)("",!0)],64)):"group_info"===e.dataIndex?((0,n.uX)(),(0,n.CE)(n.FK,{key:3},[a.group_info?((0,n.uX)(),(0,n.CE)("div",I,(0,r.v_)(a.group_info?.group_name||"未命名群聊"),1)):(0,n.Q3)("",!0)],64)):"id"===e.dataIndex?((0,n.uX)(),(0,n.CE)("a",{key:4,onClick:e=>Q(a)},"查看明细",8,X)):(0,n.Q3)("",!0)])),_:1},8,["loading","data-source","pagination"])):((0,n.uX)(),(0,n.Wv)(B,{key:1,style:{"margin-top":"88px"},description:H.keyword?"暂无匹配数据":"输入内容后搜索查看"},{image:(0,n.k6)((()=>t[14]||(t[14]=[(0,n.Lk)("img",{src:i},null,-1)]))),_:1},8,["description"]))])])),_:1})}}},M=a(1241);const W=(0,M.A)(Y,[["__scopeId","data-v-4eab6876"]]);var E=W}}]);
//# sourceMappingURL=636.ab8422b7.js.map