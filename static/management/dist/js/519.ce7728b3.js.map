{"version":3,"file":"js/519.ce7728b3.js","mappings":"oqBAyFA,MAAMA,EAAgBC,EAAQ,MACxBC,GAAQC,EAAAA,EAAAA,MACRC,GAAOC,EAAAA,EAAAA,IAAI,MACXC,GAAUD,EAAAA,EAAAA,KAAI,GACdE,GAAOF,EAAAA,EAAAA,IAAI,IACXG,GAAYH,EAAAA,EAAAA,IAAI,CAClBI,KAAM,GACNC,OAAQ,KAMNC,IAJWC,EAAAA,EAAAA,IAAS,CACtBC,cAAe,EACfC,YAAa,KAEEF,EAAAA,EAAAA,IAAS,CACxBG,KAAM,EACNC,MAAO,EACPC,SAAU,EACVC,MAAO,GACPC,SAAU,EACVC,QAAS,GACTC,MAAO,MAELC,GAAaV,EAAAA,EAAAA,IAAS,CACxBW,QAAS,EACTC,KAAM,EACNC,SAAU,GACVC,MAAO,EACPC,gBAAiB,CAAC,KAAM,KAAM,KAAM,OACpCC,iBAAiB,EACjBC,iBAAiB,IAGfC,GAAUlB,EAAAA,EAAAA,IAAS,CACrB,CACImB,MAAO,OACPC,UAAW,aACXC,MAAO,IACPC,YAAa,CACTC,aAAc,aAGtB,CACIJ,MAAO,OACPC,UAAW,WACXC,MAAO,KAEX,CACIF,MAAO,MACPC,UAAW,qBACXC,MAAO,KAEX,CACIF,MAAO,UACPC,UAAW,eACXC,MAAO,IACPG,QAAQ,GAEZ,CACIL,MAAO,UACPC,UAAW,aACXC,MAAO,IACPG,QAAQ,GAEZ,CACIL,MAAO,OACPC,UAAW,eACXE,YAAa,CACTC,aAAc,eAElBF,MAAO,KAEX,CACIF,MAAO,KACPC,UAAW,KACXE,YAAa,CACTC,aAAc,WAElBF,MAAO,OASf,SAASI,IACLC,GACJ,CAEA,SAASC,IACL,OAAOC,IAAMtC,EAAMuC,MAAMC,aAAaC,OAAO,aACjD,CAEA,SAASL,IACLhB,EAAWC,QAAU,EACrBqB,IACAC,GACJ,CAEA,SAASC,IACL,IAAIC,EAAS,CACTvB,KAAMF,EAAWC,QACjByB,KAAM1B,EAAWG,SACjBwB,YAAa/C,EAAMuC,MAAMQ,YACzBC,QAAShD,EAAMuC,MAAMC,YACrBS,WAAY,EACZC,cAA8B,kBAAfhD,EAAKiD,MAA4B,EAAI,GASxD,OAPA1C,EAAWS,QAAUT,EAAWS,QAAQkC,OACpC3C,EAAWS,UACX2B,EAAO3B,QAAUT,EAAWS,SAE5BT,EAAWU,QACX0B,EAAO1B,MAAQV,EAAWU,OAEvB0B,CACX,CAEA,SAASH,IA+CL,CAGJ,SAASC,IACL,IAAIE,EAASD,IACbC,EAAOvB,KAAO,EACduB,EAAOC,KAAO,CAalB,CAEA,SAASO,EAAYC,EAAGC,EAAGrB,GACnBA,EAAOsB,OAAStB,EAAOf,OACvBS,EAAQ6B,KAAIC,IACJA,EAAK5B,YAAcI,EAAOsB,MAC1BE,EAAKC,UAAYzB,EAAOf,MAExBuC,EAAKC,WAAY,CACrB,IAEJlD,EAAWU,MAAQ,GAAGe,EAAOsB,SAAyB,UAAhBtB,EAAOf,MAAoB,MAAQ,WAEzES,EAAQ6B,KAAIC,GAAQA,EAAKC,WAAY,IACrClD,EAAWU,MAAQ,IAEvByC,OAAOC,OAAOzC,EAAYkC,GAC1BZ,GACJ,C,OA1HAoB,EAAAA,EAAAA,KAAU,KAEN3B,GAAM,I,mrECtKV,MAAM4B,GAA2B,OAAgB,EAAQ,CAAC,CAAC,YAAY,qBAEvE,O","sources":["webpack://zmwk_session_archive/./src/views/sessionStatistics/private/detail.vue","webpack://zmwk_session_archive/./src/views/sessionStatistics/private/detail.vue?55a0"],"sourcesContent":["<template>\n    <MainLayout :title=\"[\n        {name: '单聊统计', route: '/sessionStatistics/private'},\n        {name: '员工单聊明细'}\n    ]\">\n        <div class=\"zm-main-content\">\n            <div class=\"header\">\n                <div class=\"left\">\n                    <div class=\"item zm-user-info\">\n                        <img class=\"avatar\"\n                             style=\"width: 24px;height: 24px;\"\n                             :src=\"staffInfo.avatar || defaultAvatar\"/>\n                        <span class=\"name\">{{ staffInfo.name }}</span>\n                    </div>\n                    <div class=\"hr\"></div>\n                    <div class=\"item\">统计时间：{{ statDateFormat() }}</div>\n                </div>\n                <div class=\"right filter-box\">\n                    <div class=\"filter-item ml16\">\n                        <a-input\n                            v-model=\"filterData.keyword\"\n                            allowClear\n                            placeholder=\"请输入客户名称进行搜索\"\n                            @change=\"search\"\n                            style=\"width: 220px;\"/>\n                    </div>\n                </div>\n            </div>\n            <a-tabs v-model:active=\"type\" class=\"mt8\">\n                <a-tab-pane :key=\"1\" tab=\"全部客户\"></a-tab-pane>\n                <a-tab-pane :key=\"2\" tab=\"今日新增\"></a-tab-pane>\n                <a-tab-pane :key=\"3\" tab=\"未回复\"></a-tab-pane>\n                <a-tab-pane :key=\"4\" tab=\"主动沟通\"></a-tab-pane>\n                <a-tab-pane :key=\"4\" tab=\"被动沟通\"></a-tab-pane>\n            </a-tabs>\n            <div class=\"table-box\">\n                <a-table :loading=\"loading\"\n                         :data-source=\"list\"\n                         :columns=\"columns\"\n                         :pagination=\"pagination\"\n                         :scroll=\"{x: 1000}\"\n                         @change=\"tableChange\"\n                >\n                    <template #minuteReplyRateTitle>\n                        {{ msgReplySec }}分钟回复率\n                    </template>\n                    <template #userInfo=\"text,record\">\n                        <div class=\"wk-user-info\">\n                            <img class=\"avatar\"\n                                 style=\"width: 40px;height: 40px;\"\n                                 :src=\"record.avatar\"/>\n                            <div>\n                                <div class=\"name\">{{ record.follow_remark || record.name }}</div>\n                                <div class=\"nickname\">微信昵称：{{ record.name }}</div>\n                            </div>\n                        </div>\n                    </template>\n                    <template #replyStatus=\"text,record\">\n                        <span v-if=\"record.reply_status == -1 || !record.date_no\">--</span>\n                        <div class=\"reply-status\" v-else-if=\"record.reply_status==1\">\n                            <CheckCircleFilled/>\n                            <span>已回复</span>\n                        </div>\n                        <div class=\"reply-status no\" v-else>\n                            <ExclamationCircleFilled/>\n                            <span>未回复</span>\n                        </div>\n                    </template>\n                    <template #operate=\"text,record\">\n                        <a-button type=\"link\"\n                                  style=\"padding: 0;\"\n                                  :disabled=\"!record.date_no\"\n                                  @click=\"linkChat(record,1)\">明细\n                        </a-button>\n                    </template>\n                </a-table>\n            </div>\n        </div>\n    </MainLayout>\n</template>\n\n<script setup>\nimport {onMounted, ref, reactive} from 'vue';\nimport {useRoute} from 'vue-router';\nimport dayjs from \"dayjs\";\nimport {message} from 'ant-design-vue';\nimport {ExclamationCircleFilled, CheckCircleFilled} from '@ant-design/icons-vue';\nimport MainLayout from \"@/components/mainLayout.vue\";\n\nconst defaultAvatar = require('@/assets/default-avatar.png');\nconst route = useRoute()\nconst type = ref(null)\nconst loading = ref(false)\nconst list = ref([])\nconst staffInfo = ref({\n    name: \"\",\n    avatar: \"\",\n})\nconst totalMap = reactive({\n    staff_trigger: 0,\n    cst_trigger: 0,\n})\nconst filterData = reactive({\n    year: 1,\n    month: 1,\n    dateType: 1,\n    dates: [],\n    timeType: 1,\n    keyword: \"\",\n    order: \"\",\n})\nconst pagination = reactive({\n    current: 1,\n    page: 1,\n    pageSize: 10,\n    total: 0,\n    pageSizeOptions: ['10', '20', '50', '100'],\n    showQuickJumper: true,\n    showSizeChanger: true,\n})\n\nconst columns = reactive([\n    {\n        title: \"客户信息\",\n        dataIndex: \"staff_name\",\n        width: 220,\n        scopedSlots: {\n            customRender: \"userInfo\"\n        }\n    },\n    {\n        title: \"添加时间\",\n        dataIndex: \"add_time\",\n        width: 150,\n    },\n    {\n        title: \"发起人\",\n        dataIndex: \"promoter_type_text\",\n        width: 100,\n    },\n    {\n        title: \"员工发送消息数\",\n        dataIndex: \"staff_msg_no\",\n        width: 140,\n        sorter: true,\n    },\n    {\n        title: \"客户发送消息数\",\n        dataIndex: \"cst_msg_no\",\n        width: 140,\n        sorter: true,\n    },\n    {\n        title: \"回复状态\",\n        dataIndex: \"reply_status\",\n        scopedSlots: {\n            customRender: \"replyStatus\"\n        },\n        width: 116,\n    },\n    {\n        title: \"操作\",\n        dataIndex: \"id\",\n        scopedSlots: {\n            customRender: \"operate\"\n        },\n        width: 110,\n    }\n])\n\nonMounted(() => {\n    //type.value = route.query.type\n    init()\n})\n\nfunction init() {\n    search()\n}\n\nfunction statDateFormat() {\n    return dayjs(route.query.filter_date).format(\"YYYY-MM-DD\")\n}\n\nfunction search() {\n    pagination.current = 1\n    loadData()\n    loadOtherTotal()\n}\n\nfunction getFilterParams() {\n    let params = {\n        page: pagination.current,\n        size: pagination.pageSize,\n        open_userid: route.query.open_userid,\n        date_no: route.query.filter_date,\n        valid_type: 1,\n        promoter_type: type.value === 'staff_trigger' ? 0 : 1\n    }\n    filterData.keyword = filterData.keyword.trim()\n    if (filterData.keyword) {\n        params.keyword = filterData.keyword\n    }\n    if (filterData.order) {\n        params.order = filterData.order\n    }\n    return params\n}\n\nfunction loadData() {\n    // loading.value = true\n    // let params = getFilterParams()\n    // let request = chatStatDetail\n    // let dataItemFormat = item => item\n    // if (this.MODE == 2) {\n    //     if (params.promoter_type > -1) {\n    //         params.promoter_type += 1\n    //     }\n    //     request = authModeChatStatDetail\n    //     dataItemFormat = item => {\n    //         item.promoter_type_text = item.promoter_type == 1 ? '员工' : '客户'\n    //         item.open_userid = item.stf_userid\n    //         item.finshed = false\n    //         return item\n    //     }\n    // }\n    //request(params).then(res => {\n    //     let list = res.data.list || []\n    //     let setNullFields = ['staff_msg_no', 'cst_msg_no', 'rate', 'time_st', 'promoter_type_text', 'un_reply_content', 'send_time']\n    //     list.map(item => {\n    //         item.add_time = moment(item.add_time * 1000).format(\"YY-MM-DD HH:mm\")\n    //         item.promoter_type_text = item.promoter_type == 0 ? '员工' : '客户'\n    //         if (item.last_msg) {\n    //             item.last_msg.content && formatMessage(item.last_msg)\n    //             item.send_time = formatDate(Number(item.last_msg.msg_time || 0))\n    //         }\n    //         if (item.reply_status == -1) {\n    //             item.time_st = \"--\"\n    //             item.rate = \"--\"\n    //         } else {\n    //             item.time_st = secondToDate(item.time_st)\n    //             item.rate = computedRate(Number(item.reply_no_intime), Number(item.round_no))\n    //         }\n    //         if (!item.date_no) {\n    //             for (let field of setNullFields) {\n    //                 item[field] = \"--\"\n    //             }\n    //         }\n    //         item.staff_user_id = this.staffInfo['real_user_id'] ?? ''\n    //         item = dataItemFormat(item)\n    //     })\n    //     list.value = list\n    //     pagination.total = Number(res.data.count)\n    //     totalMap[this.type] = this.pagination.total\n    // }).finally(() => {\n    //     loading.value = false\n    // })\n}\n\nfunction loadOtherTotal() {\n    let params = getFilterParams()\n    params.page = 1\n    params.size = 1\n    // params.promoter_type = type === 'staff_trigger' ? 1 : 0\n    // let request = chatStatDetail\n    // if (this.MODE == 2) {\n    //     if (params.promoter_type > -1) {\n    //         params.promoter_type += 1\n    //     }\n    //     request = authModeChatStatDetail\n    // }\n    // request(params).then(res => {\n    //     let total = Number(res.data.count)\n    //     this.totalMap[this.type === 'staff_trigger' ? 'cst_trigger' : 'staff_trigger'] = total\n    // })\n}\n\nfunction tableChange(p, _, sorter) {\n    if (sorter.field && sorter.order) {\n        columns.map(item => {\n            if (item.dataIndex === sorter.field) {\n                item.sortOrder = sorter.order\n            } else {\n                item.sortOrder = false\n            }\n        })\n        filterData.order = `${sorter.field} ${sorter.order == 'ascend' ? 'ASC' : 'DESC'}`\n    } else {\n        columns.map(item => item.sortOrder = false)\n        filterData.order = \"\"\n    }\n    Object.assign(pagination, p)\n    loadData()\n}\n</script>\n\n<style scoped lang=\"less\">\n.zm-main-content {\n    min-height: 86vh;\n}\n\n.header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n\n    .left {\n        display: flex;\n        align-items: center;\n        font-size: 14px;\n        font-weight: 400;\n        color: #595959;\n\n        .item {\n            display: flex;\n            align-items: center;\n        }\n\n        .hr {\n            background: #D9D9D9;\n            width: 1px;\n            height: 12px;\n            margin: 0 16px;\n        }\n    }\n}\n\n.reply-status {\n    display: inline-block;\n    font-size: 14px;\n    font-weight: 600;\n    color: #21A665;\n    padding: 2px 6px;\n    border-radius: 2px;\n    background: #E8FCF3;\n\n    span {\n        margin-left: 4px;\n    }\n\n    &.no {\n        background: #FAEBE6;\n        color: #ED744A;\n    }\n}\n\n.filter-box {\n    display: flex;\n    flex-wrap: wrap;\n\n    .filter-item:last-child {\n        margin-right: 0;\n    }\n\n    .filter-item {\n        display: flex;\n        align-items: center;\n        margin: 0 16px 16px 0;\n\n        .item-label {\n            font-size: 14px;\n            font-weight: 400;\n            color: #262626;\n            width: 70px;\n            flex-shrink: 0;\n        }\n\n        .item-body {\n            flex: 1;\n        }\n    }\n}\n\n.msg-content-box {\n    display: flex;\n    align-items: flex-start;\n}\n\n.last-sender-info {\n    font-size: 14px;\n    font-weight: 400;\n    color: rgba(0, 0, 0, 0.65);\n    display: flex;\n    align-items: center;\n\n    .name {\n        white-space: nowrap;\n    }\n\n    .avatar {\n        flex-shrink: 0;\n        width: 24px;\n        height: 24px;\n        border-radius: 2px;\n        margin-right: 8px;\n    }\n}\n\n.session-content {\n    height: 40px;\n    overflow: hidden;\n}\n</style>\n","import script from \"./detail.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./detail.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./detail.vue?vue&type=style&index=0&id=c47d9de6&scoped=true&lang=less\"\n\nimport exportComponent from \"../../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-c47d9de6\"]])\n\nexport default __exports__"],"names":["defaultAvatar","require","route","useRoute","type","ref","loading","list","staffInfo","name","avatar","filterData","reactive","staff_trigger","cst_trigger","year","month","dateType","dates","timeType","keyword","order","pagination","current","page","pageSize","total","pageSizeOptions","showQuickJumper","showSizeChanger","columns","title","dataIndex","width","scopedSlots","customRender","sorter","init","search","statDateFormat","dayjs","query","filter_date","format","loadData","loadOtherTotal","getFilterParams","params","size","open_userid","date_no","valid_type","promoter_type","value","trim","tableChange","p","_","field","map","item","sortOrder","Object","assign","onMounted","__exports__"],"sourceRoot":""}