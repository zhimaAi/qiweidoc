{"version":3,"file":"js/167.40d42e45.js","mappings":"qLACIA,EAAe,CAAE,KAAQ,CAAE,IAAO,MAAO,MAAS,CAAE,QAAW,gBAAiB,UAAa,SAAW,SAAY,CAAC,CAAE,IAAO,OAAQ,MAAS,CAAE,EAAK,guBAAouB,KAAQ,OAAQ,MAAS,YACv5B,I,UCAA,SAASC,EAAcC,GAAU,IAAK,IAAIC,EAAI,EAAGA,EAAIC,UAAUC,OAAQF,IAAK,CAAE,IAAIG,EAAyB,MAAhBF,UAAUD,GAAaI,OAAOH,UAAUD,IAAM,CAAC,EAAOK,EAAUD,OAAOE,KAAKH,GAAqD,oBAAjCC,OAAOG,wBAAwCF,EAAUA,EAAQG,OAAOJ,OAAOG,sBAAsBJ,GAAQM,QAAO,SAAUC,GAAO,OAAON,OAAOO,yBAAyBR,EAAQO,GAAKE,UAAY,MAAOP,EAAQQ,SAAQ,SAAUC,GAAOC,EAAgBhB,EAAQe,EAAKX,EAAOW,GAAO,GAAI,CAAE,OAAOf,CAAQ,CAExe,SAASgB,EAAgBC,EAAKF,EAAKG,GAAiK,OAApJH,KAAOE,EAAOZ,OAAOc,eAAeF,EAAKF,EAAK,CAAEG,MAAOA,EAAOL,YAAY,EAAMO,cAAc,EAAMC,UAAU,IAAkBJ,EAAIF,GAAOG,EAAgBD,CAAK,CAOhN,IAAInB,EAAe,SAAsBwB,EAAOC,GAC9C,IAAIC,EAAIzB,EAAc,CAAC,EAAGuB,EAAOC,EAAQE,OAEzC,OAAOC,EAAAA,EAAAA,IAAaC,EAAAA,EAAU5B,EAAc,CAAC,EAAGyB,EAAG,CACjD,KAAQI,IACN,KACN,EAEA9B,EAAa+B,YAAc,eAC3B/B,EAAagC,cAAe,EAC5B,O,sNCnBO,MAAMC,EAAsBA,IACxBC,EAAAA,EAAQC,IAAI,wBAGVC,EAAiBA,IACnBF,EAAAA,EAAQC,IAAI,wBAGVE,EAAaC,GACfJ,EAAAA,EAAQC,IAAI,kBAAmB,CAACI,OAAQD,IAGtCE,EAAcF,GAChBJ,EAAAA,EAAQC,IAAI,mBAAoB,CAACI,OAAQD,IAGvCG,EAAcH,GAChBJ,EAAAA,EAAQC,IAAI,mBAAoB,CAACI,OAAQD,IAGvCI,EAAiBJ,GACnBJ,EAAAA,EAAQC,IAAI,sBAAuB,CAACI,OAAQD,IAG1CK,EAAiBL,GACnBJ,EAAAA,EAAQC,IAAI,sBAAuB,CAACI,OAAQD,G,8OCbvD,MAAMM,EAAOC,EACPP,GAAOQ,EAAAA,EAAAA,IAAI,IACXC,GAAeD,EAAAA,EAAAA,IAAI,KAEzBE,EAAAA,EAAAA,KAAU,KACNC,GAAU,IAGd,MAAMA,EAAWA,MACbb,EAAAA,EAAAA,MAAiBc,MAAKC,IAClB,IAAIC,EAAOD,EAAIb,MAAQ,GACvBc,EAAOA,EAAKC,KAAIC,GACLC,EAAQD,KAEnBhB,EAAKlB,MAAQgC,CAAG,GAClB,EAGAG,EAAUA,CAACC,EAAYC,EAAY,KACrC,IAAIxC,EAAM,GAAGwC,KAAaD,EAAWE,gBAMrC,OALIF,GAAYG,YAAYtD,OAAS,IACjCmD,EAAWI,SAAWJ,EAAWG,WAAWN,KAAIC,GACrCC,EAAQD,EAAMrC,MAGtB,CACHA,IAAKA,EACL4C,MAAOL,EAAWM,KAClBF,SAAUJ,EAAWI,SACxB,EAGCG,EAAeA,KACjBnB,EAAK,SAAUG,EAAa3B,MAAM,E,qPC5CtC,MAAM4C,EAAc,EAEpB,Q,6SCiFA,MAKMC,EAAU,CACZ,CACIC,UAAW,OACXL,MAAO,KACPM,MAAO,KAOX,CACID,UAAW,YACXC,MAAO,GACPN,MAAO,QAEX,CACIK,UAAW,kBACXC,MAAO,IACPN,MAAO,QAEX,CACIK,UAAW,WACXC,MAAO,IACPN,MAAO,SAITO,GAAUtB,EAAAA,EAAAA,KAAI,GACduB,GAAUvB,EAAAA,EAAAA,KAAI,GACdwB,GAAYxB,EAAAA,EAAAA,IAAI,GAChBM,GAAON,EAAAA,EAAAA,IAAI,IACXyB,GAAaC,EAAAA,EAAAA,IAAS,CACxBC,MAAO,EACPC,QAAS,EACTC,SAAU,GACVC,iBAAiB,EACjBC,gBAAiB,CAAC,KAAM,KAAM,KAAM,SAElCC,GAAaN,EAAAA,EAAAA,IAAS,CACxBO,QAAS,GACTC,YAAa,GACbtB,cAAe,MAGnBV,EAAAA,EAAAA,KAAU,KACNiC,IACAhC,GAAU,IAGd,MAAMgC,EAAWA,MACT9C,EAAAA,EAAAA,IAAI,2BAA8B+C,MAAQC,OAAO,cACjDC,KACAC,EAAAA,EAAAA,IAAI,yBAA0BH,MAAQC,OAAO,aACjD,EAGEC,EAAYA,KACd,MAAMhB,EAAUkB,EAAAA,GAAQlB,QAAQ,QAChCC,EAAQjD,OAAQ,GAChBa,EAAAA,EAAAA,MAAsBiB,MAAKC,IACvBmC,EAAAA,GAAQC,QAAQ,OAAO,IACxBC,SAAQ,KACPpB,IACAC,EAAQjD,OAAQ,CAAI,GACtB,EAGAqE,EAASA,KACXrC,EAAKhC,MAAQ,GACbmD,EAAWE,MAAQ,EACnBF,EAAWG,QAAU,EACrBzB,GAAU,EAGRA,EAAWA,KACbmB,EAAQhD,OAAQ,EAChB,IAAImB,EAAS,CACTmD,KAAMnB,EAAWG,QACjBiB,KAAMpB,EAAWI,UAErBG,EAAWC,QAAUD,EAAWC,QAAQa,OACpCd,EAAWC,UACXxC,EAAOwC,QAAUD,EAAWC,SAE5BD,EAAWpB,gBACXnB,EAAOmB,cAAgBoB,EAAWpB,gBAEtCrB,EAAAA,EAAAA,IAAUE,GAAQW,MAAKC,IACnBC,EAAKhC,MAAQ+B,EAAIb,KAAKuD,OAAS,GAC/BtB,EAAWE,MAAQqB,OAAO3C,EAAIb,KAAKmC,MAAM,IAC1Ce,SAAQ,KACPpB,EAAQhD,OAAQ,CAAI,GACtB,EAGA2E,EAAcrE,IAChB6C,EAAWG,QAAUhD,EAAEgD,QACvBH,EAAWI,SAAWjD,EAAEiD,SACxB1B,GAAU,EAGR+C,EAAmBC,IACrB,IAAIhF,EAAMgF,EAAO,IAAM,KACvB,GAAIhF,EAAK,CACL,IAAIiF,EAAMjF,EAAIkF,MAAM,KACpBrB,EAAWpB,cAAgBwC,EAAIE,OAAO,GAAG,EAC7C,CACAX,GAAQ,E,uoECjMZ,MAAM,GAA2B,OAAgB,EAAQ,CAAC,CAAC,YAAY,qBAEvE,O","sources":["webpack://zmwk_session_archive/./node_modules/@ant-design/icons-svg/es/asn/SyncOutlined.js","webpack://zmwk_session_archive/./node_modules/@ant-design/icons-vue/es/icons/SyncOutlined.js","webpack://zmwk_session_archive/./src/api/company.js","webpack://zmwk_session_archive/./src/components/company/staffDepartmentStruct.vue","webpack://zmwk_session_archive/./src/components/company/staffDepartmentStruct.vue?1b5e","webpack://zmwk_session_archive/./src/views/companyManagement/staff.vue","webpack://zmwk_session_archive/./src/views/companyManagement/staff.vue?3e09"],"sourcesContent":["// This icon file is generated automatically.\nvar SyncOutlined = { \"icon\": { \"tag\": \"svg\", \"attrs\": { \"viewBox\": \"64 64 896 896\", \"focusable\": \"false\" }, \"children\": [{ \"tag\": \"path\", \"attrs\": { \"d\": \"M168 504.2c1-43.7 10-86.1 26.9-126 17.3-41 42.1-77.7 73.7-109.4S337 212.3 378 195c42.4-17.9 87.4-27 133.9-27s91.5 9.1 133.8 27A341.5 341.5 0 01755 268.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.7 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c0-6.7-7.7-10.5-12.9-6.3l-56.4 44.1C765.8 155.1 646.2 92 511.8 92 282.7 92 96.3 275.6 92 503.8a8 8 0 008 8.2h60c4.4 0 7.9-3.5 8-7.8zm756 7.8h-60c-4.4 0-7.9 3.5-8 7.8-1 43.7-10 86.1-26.9 126-17.3 41-42.1 77.8-73.7 109.4A342.45 342.45 0 01512.1 856a342.24 342.24 0 01-243.2-100.8c-9.9-9.9-19.2-20.4-27.8-31.4l60.2-47a8 8 0 00-3-14.1l-175.7-43c-5-1.2-9.9 2.6-9.9 7.7l-.7 181c0 6.7 7.7 10.5 12.9 6.3l56.4-44.1C258.2 868.9 377.8 932 512.2 932c229.2 0 415.5-183.7 419.8-411.8a8 8 0 00-8-8.2z\" } }] }, \"name\": \"sync\", \"theme\": \"outlined\" };\nexport default SyncOutlined;\n","import { createVNode as _createVNode } from \"vue\";\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? Object(arguments[i]) : {}; var ownKeys = Object.keys(source); if (typeof Object.getOwnPropertySymbols === 'function') { ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) { return Object.getOwnPropertyDescriptor(source, sym).enumerable; })); } ownKeys.forEach(function (key) { _defineProperty(target, key, source[key]); }); } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\nimport SyncOutlinedSvg from \"@ant-design/icons-svg/es/asn/SyncOutlined\";\nimport AntdIcon from '../components/AntdIcon';\n\nvar SyncOutlined = function SyncOutlined(props, context) {\n  var p = _objectSpread({}, props, context.attrs);\n\n  return _createVNode(AntdIcon, _objectSpread({}, p, {\n    \"icon\": SyncOutlinedSvg\n  }), null);\n};\n\nSyncOutlined.displayName = 'SyncOutlined';\nSyncOutlined.inheritAttrs = false;\nexport default SyncOutlined;","import request from \"@/api/request\";\n\nexport const syncDepartmentStaff = () => {\n    return request.get('/api/department/sync')\n}\n\nexport const departmentList = () => {\n    return request.get('/api/department/list')\n}\n\nexport const staffList = (data) => {\n    return request.get('/api/staff/list', {params: data})\n}\n\nexport const groupsList = (data) => {\n    return request.get('/api/groups/list', {params: data})\n}\n\nexport const groupsSync = (data) => {\n    return request.get('/api/groups/sync', {params: data})\n}\n\nexport const customersList = (data) => {\n    return request.get('/api/customers/list', {params: data})\n}\n\nexport const customersSync = (data) => {\n    return request.get('/api/customers/sync', {params: data})\n}\n","<template>\n    <a-tree\n        v-model:selected-keys=\"selectedKeys\"\n        @select=\"selectChange\"\n        block-node\n        showLine\n        :tree-data=\"data\"\n    />\n</template>\n\n<script setup>\nimport {onMounted, ref} from 'vue';\nimport {departmentList} from \"@/api/company\";\n\nconst emit = defineEmits(['change']);\nconst data = ref([])\nconst selectedKeys = ref([])\n\nonMounted(() => {\n    loadData()\n})\n\nconst loadData = () => {\n    departmentList().then(res => {\n        let list = res.data || []\n        list = list.map(item => {\n            return getNode(item)\n        })\n        data.value = list\n    })\n}\n\nconst getNode = (department, parentKey = 0) => {\n    let key = `${parentKey}-${department.department_id}`\n    if (department?.child_node?.length > 0) {\n        department.children = department.child_node.map(item => {\n            return getNode(item, key)\n        })\n    }\n    return {\n        key: key,\n        title: department.name,\n        children: department.children,\n    }\n}\n\nconst selectChange = () => {\n    emit('change', selectedKeys.value)\n}\n</script>\n\n<style scoped lang=\"less\">\n\n</style>\n","import script from \"./staffDepartmentStruct.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./staffDepartmentStruct.vue?vue&type=script&setup=true&lang=js\"\n\nconst __exports__ = script;\n\nexport default __exports__","<template>\n    <MainLayout title=\"员工管理\">\n        <div class=\"container\">\n            <div class=\"left-block\">\n                <div class=\"header-box\">\n                    <div class=\"operate-box\">\n                        <a-button type=\"primary\" :loading=\"syncing\" :icon=\"h(SyncOutlined)\" @click=\"syncStaff\">同步员工和部门</a-button>\n                    </div>\n                    <div class=\"zm-flex-between mt8\">\n                        <div>总员工数：<strong>{{ pagination.total }}</strong></div>\n                        <div class=\"zm-filter-box\">\n<!--                            <div class=\"zm-filter-item\">-->\n<!--                                <div class=\"zm-filter-label\">授权状态：</div>-->\n<!--                                <a-select-->\n<!--                                    style=\"width: 90px;\" v-model:value=\"filterData.auth_status\" @change=\"search\"-->\n<!--                                >-->\n<!--                                    <a-select-option-->\n<!--                                        v-for=\"item in authStatus\"-->\n<!--                                        :key=\"item.value\"-->\n<!--                                        :value=\"item.value\">{{ item.title }}-->\n<!--                                    </a-select-option>-->\n<!--                                </a-select>-->\n<!--                            </div>-->\n                            <div class=\"zm-filter-item\">\n                                <div class=\"zm-filter-label\">搜索员工：</div>\n                                <a-input-search\n                                    style=\"width: 200px;\" placeholder=\"请输入昵称或别名搜索\"\n                                    v-model:value=\"filterData.keyword\"\n                                    allowClear\n                                    @search=\"search\"\n                                ></a-input-search>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                <a-table\n                    class=\"mt16\"\n                    :loading=\"loading\"\n                    :data-source=\"list\"\n                    :columns=\"columns\"\n                    :pagination=\"pagination\"\n                    @change=\"tableChange\"\n                >\n                    <template #bodyCell=\"{ column, text, record }\">\n                        <template v-if=\"'name' === column.dataIndex\">\n                            <div class=\"zm-user-info\">\n                                <img class=\"avatar\" src=\"@/assets/default-avatar.png\"/>\n                                <span class=\"name\">{{ record.name }}</span>\n                            </div>\n                        </template>\n                        <template v-else-if=\"'tag_name' === column.dataIndex\">\n                            <a-popover v-if=\"text?.length > 3\">\n                                <template #content>\n                                    <div v-for=\"(name, i) in text\" :key=\"i\">{{name}}</div>\n                                </template>\n                                <a-tag v-for=\"(name, i) in text.slice(0, 3)\" :key=\"i\">{{name}}</a-tag>\n                                <span>+{{text.length - 3}}</span>\n                            </a-popover>\n                            <template v-else>\n                                <a-tag v-for=\"(name, i) in text\" :key=\"i\">{{name}}</a-tag>\n                            </template>\n                        </template>\n                    </template>\n                </a-table>\n            </div>\n            <div class=\"right-block ml16\">\n                <a-tabs v-model:activeKey=\"activeKey\">\n                    <a-tab-pane :key=\"1\" tab=\"组织架构\">\n                        <StaffDepartmentStruct @change=\"departmentChange\"/>\n                    </a-tab-pane>\n                </a-tabs>\n            </div>\n        </div>\n    </MainLayout>\n</template>\n\n<script setup>\nimport {onMounted, ref, reactive, h} from 'vue';\nimport dayjs from 'dayjs';\nimport {message} from 'ant-design-vue';\nimport {SyncOutlined} from '@ant-design/icons-vue';\nimport MainLayout from \"@/components/mainLayout.vue\";\nimport {staffList, syncDepartmentStaff} from \"@/api/company\";\nimport StaffDepartmentStruct from \"@/components/company/staffDepartmentStruct.vue\";\nimport {set,get} from \"@/utils/cache\";\n\nconst authStatus = [\n    {title: '全部', value: '',},\n    {title: '未授权', value: 0,},\n    {title: '已授权', value: 1,},\n]\nconst columns = [\n    {\n        dataIndex: 'name',\n        title: \"员工\",\n        width: 150,\n    },\n    // {\n    //     dataIndex: \"auth_status\",\n    //     width: 95,\n    //     title: \"授权状态\",\n    // },\n    {\n        dataIndex: \"cst_total\",\n        width: 90,\n        title: \"客户总数\",\n    },\n    {\n        dataIndex: \"department_name\",\n        width: 140,\n        title: \"所属部门\",\n    },\n    {\n        dataIndex: \"tag_name\",\n        width: 135,\n        title: \"员工标签\",\n    },\n]\n\nconst loading = ref(false)\nconst syncing = ref(false)\nconst activeKey = ref(1)\nconst list = ref([])\nconst pagination = reactive({\n    total: 0,\n    current: 1,\n    pageSize: 10,\n    showSizeChanger: true,\n    pageSizeOptions: ['10', '20', '50', '100'],\n})\nconst filterData = reactive({\n    keyword: '',\n    auth_status: '',\n    department_id: '',\n})\n\nonMounted(() => {\n    autoSync()\n    loadData()\n})\n\nconst autoSync = () => {\n    if (get('zm:sync:staff:last:day') !=  dayjs().format('YYYYMMDD')) {\n        syncStaff()\n        set('zm:sync:staff:last:day', dayjs().format('YYYYMMDD'))\n    }\n}\n\nconst syncStaff = () => {\n    const loading = message.loading('正在同步')\n    syncing.value = true\n    syncDepartmentStaff().then(res => {\n        message.success('同步完成')\n    }).finally(() => {\n        loading()\n        syncing.value = false\n    })\n}\n\nconst search = () => {\n    list.value = []\n    pagination.total = 1\n    pagination.current = 1\n    loadData()\n}\n\nconst loadData = () => {\n    loading.value = true\n    let params = {\n        page: pagination.current,\n        size: pagination.pageSize\n    }\n    filterData.keyword = filterData.keyword.trim()\n    if (filterData.keyword) {\n        params.keyword = filterData.keyword\n    }\n    if (filterData.department_id) {\n        params.department_id = filterData.department_id\n    }\n    staffList(params).then(res => {\n        list.value = res.data.items || []\n        pagination.total = Number(res.data.total)\n    }).finally(() => {\n        loading.value = false\n    })\n}\n\nconst tableChange = p => {\n    pagination.current = p.current\n    pagination.pageSize = p.pageSize\n    loadData()\n}\n\nconst departmentChange = select => {\n    let key = select[0] || null\n    if (key) {\n        let ids = key.split('-')\n        filterData.department_id = ids.slice(-1)[0]\n    }\n    search()\n}\n</script>\n\n<style scoped lang=\"less\">\n.container {\n    display: flex;\n    margin: 12px;\n\n    > div {\n        background: #FFF;\n        border-radius: 2px;\n        overflow-y: scroll;\n        height: calc(100vh - 130px);\n    }\n\n    .left-block {\n        padding: 12px;\n        flex: 1;\n    }\n\n    .right-block {\n        flex-shrink: 0;\n        width: 16vw;\n        max-width: 300px;\n\n        :deep(.ant-tabs) {\n            .ant-tabs-tab {\n                margin: 0 12px;\n            }\n\n            .ant-tabs-content {\n                padding: 0 12px;\n            }\n        }\n    }\n}\n</style>\n","import script from \"./staff.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./staff.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./staff.vue?vue&type=style&index=0&id=3e991eac&scoped=true&lang=less\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-3e991eac\"]])\n\nexport default __exports__"],"names":["SyncOutlined","_objectSpread","target","i","arguments","length","source","Object","ownKeys","keys","getOwnPropertySymbols","concat","filter","sym","getOwnPropertyDescriptor","enumerable","forEach","key","_defineProperty","obj","value","defineProperty","configurable","writable","props","context","p","attrs","_createVNode","AntdIcon","SyncOutlinedSvg","displayName","inheritAttrs","syncDepartmentStaff","request","get","departmentList","staffList","data","params","groupsList","groupsSync","customersList","customersSync","emit","__emit","ref","selectedKeys","onMounted","loadData","then","res","list","map","item","getNode","department","parentKey","department_id","child_node","children","title","name","selectChange","__exports__","columns","dataIndex","width","loading","syncing","activeKey","pagination","reactive","total","current","pageSize","showSizeChanger","pageSizeOptions","filterData","keyword","auth_status","autoSync","dayjs","format","syncStaff","set","message","success","finally","search","page","size","trim","items","Number","tableChange","departmentChange","select","ids","split","slice"],"sourceRoot":""}