{"version":3,"file":"js/842.a82602d9.js","mappings":"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","sources":["webpack://zmwk_session_archive/./node_modules/vue-loader/dist/exportHelper.js","webpack://zmwk_session_archive/./src/components/mainFooter.vue","webpack://zmwk_session_archive/./src/components/mainFooter.vue?2da5","webpack://zmwk_session_archive/./src/components/mainHeader.vue","webpack://zmwk_session_archive/./src/components/mainHeader.vue?2300","webpack://zmwk_session_archive/./src/views/login.vue","webpack://zmwk_session_archive/./src/views/login.vue?6051"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n// runtime helper for setting properties on components\n// in a tree-shakable way\nexports.default = (sfc, props) => {\n    const target = sfc.__vccOpts || sfc;\n    for (const [key, val] of props) {\n        target[key] = val;\n    }\n    return target;\n};\n","<template>\r\n    <div id=\"_footer\" class=\"_main-footer normal hide\">\r\n        <div class=\"copyright\">Copyright © 2021, 芝麻小事网络科技（武汉）有限公司</div>\r\n    </div>\r\n</template>\r\n\r\n<script setup>\r\nimport {onMounted} from \"vue\";\r\n\r\nonMounted(() => {\r\n    window.addEventListener('load', adjustFooterPosition);\r\n    window.addEventListener('resize', adjustFooterPosition);\r\n    setTimeout(() => {\r\n        adjustFooterPosition()\r\n        document.getElementById('_footer').classList.remove('hide')\r\n    }, 1000)\r\n})\r\n\r\nfunction adjustFooterPosition() {\r\n    const contentHeight = document.body.scrollHeight;\r\n    const viewportHeight = window.innerHeight;\r\n    const footer = document.getElementById('_footer');\r\n    if (!footer) {\r\n        return\r\n    }\r\n    // 如果内容高度超过视口高度的，则正常显示，否则固定到底部\r\n    if (contentHeight > viewportHeight) {\r\n        footer.classList.add('normal');\r\n    } else {\r\n        footer.classList.remove('normal');\r\n    }\r\n}\r\n</script>\r\n\r\n<style scoped lang=\"less\">\r\n._main-footer {\r\n    position: fixed;\r\n    width: 100%;\r\n    left: 0;\r\n    bottom: 24px;\r\n    text-align: center;\r\n\r\n    &.hide {\r\n        opacity: 0;\r\n    }\r\n\r\n    &.normal {\r\n        position: relative;\r\n        margin-top: 48px;\r\n    }\r\n\r\n    .copyright {\r\n        color: #8c8c8c;\r\n        font-size: 12px;\r\n        font-weight: 400;\r\n    }\r\n}\r\n</style>\r\n","import script from \"./mainFooter.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./mainFooter.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./mainFooter.vue?vue&type=style&index=0&id=6e41ce21&scoped=true&lang=less\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-6e41ce21\"]])\n\nexport default __exports__","<template>\r\n    <div class=\"_main-header\" :style=\"style\">\r\n        <div class=\"logo-box\">\r\n            <img src=\"@/assets/logo.png\" class=\"logo\"/>\r\n        </div>\r\n        <div class=\"right-header-nav\">\r\n            <div v-if=\"showMenus\" class=\"my-shadow\"></div>\r\n            <div>\r\n                <div v-if=\"showMenus\" class=\"menus-box\">\r\n                    <div class=\"menu-item active\">会话质检</div>\r\n                </div>\r\n            </div>\r\n            <a-dropdown v-if=\"loginInfo.id > 0\">\r\n                <div class=\"user-info-box\">\r\n                    <img src=\"@/assets/default-avatar.png\" class=\"avatar\"/>\r\n                    <span class=\"ml4\">{{ loginInfo.userid }}</span>\r\n                    <DownOutlined class=\"ml4\"/>\r\n                </div>\r\n                <template #overlay>\r\n                    <a-menu>\r\n                        <a-menu-item></a-menu-item>\r\n                        <a-menu-item>\r\n                            <div class=\"text-center\" @click=\"logout\">\r\n                               <a>退出登录</a>\r\n                            </div>\r\n                        </a-menu-item>\r\n                        <a-menu-item></a-menu-item>\r\n                    </a-menu>\r\n                </template>\r\n            </a-dropdown>\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<script setup>\r\nimport {computed} from 'vue';\r\nimport {useStore} from 'vuex';\r\nimport {Modal, message} from 'ant-design-vue';\r\nimport {DownOutlined} from '@ant-design/icons-vue';\r\nimport {logoutHandle} from \"@/utils/tools\";\r\n\r\nconst props = defineProps({\r\n    background: String,\r\n    showMenus: {\r\n        type: Boolean,\r\n        default: false\r\n    },\r\n})\r\n\r\nconst store = useStore()\r\nconst loginInfo = computed(() => {\r\n    return store.getters.getUserInfo\r\n})\r\n\r\nconst style = computed(() => {\r\n    return {\r\n        background: props.background,\r\n    }\r\n})\r\n\r\nconst logout = () => {\r\n    Modal.confirm({\r\n        title: '提示',\r\n        content: '确认退出当前登录账户？',\r\n        onOk: () => {\r\n            message.loading('正在退出...')\r\n            setTimeout(() => {\r\n                message.destroy()\r\n                logoutHandle()\r\n            }, 1000)\r\n        }\r\n    })\r\n}\r\n</script>\r\n\r\n<style scoped lang=\"less\">\r\n._main-header {\r\n    display: flex;\r\n    align-items: center;\r\n    position: fixed;\r\n    z-index: 99;\r\n    top: 0;\r\n    left: 0;\r\n    width: 100%;\r\n    background: #E6EFFF;\r\n    box-shadow: 0 2px 4px 1px rgba(0, 0, 0, 0.12);\r\n\r\n    .logo-box {\r\n        display: flex;\r\n        width: 256px;\r\n        flex-shrink: 0;\r\n\r\n        .logo {\r\n            height: 52px;\r\n        }\r\n    }\r\n\r\n    .right-header-nav {\r\n        flex: 1;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: space-between;\r\n        padding-left: 24px;\r\n        position: relative;\r\n\r\n        .my-shadow {\r\n            position: absolute;\r\n            width: 3px;\r\n            height: 52px;\r\n            left: -4px;\r\n            box-shadow: 5px 0 10px rgba(0, 0, 0, 0.3);\r\n            background: #f6f7fb;\r\n            top: -10px;\r\n        }\r\n\r\n        .menus-box {\r\n            display: flex;\r\n            align-items: center;\r\n\r\n            .menu-item {\r\n                width: 98px;\r\n                height: 36px;\r\n                margin-right: 25px;\r\n                display: flex;\r\n                align-items: center;\r\n                justify-content: center;\r\n                cursor: pointer;\r\n                font-size: 16px;\r\n                font-weight: 400;\r\n                color: rgba(0, 0, 0, 0.85);\r\n                border-radius: 4px;\r\n\r\n                &.active {\r\n                    background: rgba(36, 117, 252, 0.2);\r\n                    color: #2475fc;\r\n                    font-weight: 600;\r\n                }\r\n\r\n                &:not(.active):hover {\r\n                    background: rgba(0, 0, 0, 0.04);\r\n                    color: #2475fc;\r\n                }\r\n            }\r\n        }\r\n\r\n        .user-info-box {\r\n            display: flex;\r\n            align-items: center;\r\n            cursor: pointer;\r\n            color: #595959;\r\n            font-size: 14px;\r\n            font-weight: 400;\r\n            margin: 0 16px;\r\n\r\n            .avatar {\r\n                width: 24px;\r\n                height: 24px;\r\n                border-radius: 4px;\r\n            }\r\n        }\r\n    }\r\n}\r\n</style>\r\n","import script from \"./mainHeader.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./mainHeader.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./mainHeader.vue?vue&type=style&index=0&id=5be8bb28&scoped=true&lang=less\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-5be8bb28\"]])\n\nexport default __exports__","<template>\r\n    <div class=\"_main-container\">\r\n        <MainHeader/>\r\n        <div class=\"main-content\">\r\n            <div class=\"left-box\">\r\n                <img src=\"@/assets/login-cover.png\" class=\"cover\"/>\r\n            </div>\r\n            <div class=\"right-box\">\r\n                <div id=\"ww_login\"></div>\r\n                <!--                <div class=\"title\">企业微信登录扫码登录</div>-->\r\n                <!--                <div class=\"qrcode\"></div>-->\r\n                <!--                <div class=\"tip-info mt16\">请使用企业微信扫描二维码登录</div>-->\r\n            </div>\r\n        </div>\r\n        <MainFooter/>\r\n    </div>\r\n</template>\r\n\r\n<script setup>\r\nimport {onMounted, getCurrentInstance, ref} from 'vue';\r\nimport {useRouter} from 'vue-router';\r\nimport {useStore} from 'vuex';\r\nimport MainHeader from \"@/components/mainHeader.vue\";\r\nimport MainFooter from \"@/components/mainFooter.vue\";\r\nimport {checkInit, getCurrentCorp, getCurrentUser, loginByCode} from \"@/api/auth-login\";\r\nimport {setAuthToken, setCorpInfo, setUserInfo} from \"@/utils/cache\";\r\n\r\nconst {proxy} = getCurrentInstance();\r\nconst router = useRouter()\r\nconst store = useStore()\r\nconst loading = ref(true)\r\n\r\nonMounted(async () => {\r\n    console.log('ww', ww)\r\n    console.log('SDK_VERSION', ww.SDK_VERSION)\r\n    console.log('process.env.NODE_ENV', process.env.NODE_ENV)\r\n    // 验证是否完成企业初始化\r\n    checkCorpInit()\r\n})\r\n\r\nconst localLoginTest = () => {\r\n    loginAfterHandle('eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpZCI6NTQ4MzY0LCJjb3JwX2lkIjoid3c1ZjQzMmIzYTI0YTliOWYxIiwiZXhwIjoxNzMyMDg3MjU1fQ.1CrKj4lNDrfILlnFqR6ReOZ3nS5AD2QCuR3ru0_I-lI')\r\n}\r\n\r\nconst checkCorpInit = () => {\r\n    checkInit().then(res => {\r\n        if (res?.data?.init) {\r\n            let {corp_id, agent_id} = res.data\r\n            loginInit(corp_id, agent_id)\r\n            //TODO 本地环境直接登录（本地域名无法生成登录二维码）\r\n            process.env.NODE_ENV === 'development' && localLoginTest()\r\n        } else {\r\n            // 企业信息不存在\r\n            proxy.$message.warning('企业信息不存在，请先注册企业信息！')\r\n            setTimeout(() => {\r\n                router.push({path: '/authorizedAccess/index'})\r\n            }, 1000)\r\n        }\r\n    }).finally(() => {\r\n        loading.value = false\r\n    })\r\n}\r\n\r\nconst loginInit = async (corp_id, agent_id) => {\r\n    try {\r\n        const wwLogin = ww.createWWLoginPanel({\r\n            el: '#ww_login',\r\n            params: {\r\n                login_type: 'CorpApp',\r\n                appid: corp_id,\r\n                agentid: agent_id,\r\n                redirect_uri: window.location.origin,\r\n                state: 'loginState',\r\n                redirect_type: 'callback',\r\n            },\r\n            onCheckWeComLogin({isWeComLogin}) {\r\n                console.log(isWeComLogin)\r\n            },\r\n            onLoginSuccess({code}) {\r\n                console.log({code})\r\n                loginByCode({\r\n                    corp_id: corp_id,\r\n                    code,\r\n                }).then(res => {\r\n                    console.log('res', res)\r\n                    loginAfterHandle(res.data.token)\r\n                })\r\n            },\r\n            onLoginFail(err) {\r\n                console.log(err)\r\n            },\r\n        })\r\n    } catch (e) {\r\n        console.log(\"loginInit Err:\", e)\r\n        proxy.$message.error('初始化登录失败！')\r\n    }\r\n}\r\n\r\nconst loginAfterHandle = async token => {\r\n    try {\r\n        setAuthToken(token)\r\n        const userInfo = await getCurrentUser()\r\n        const corpInfo = await getCurrentCorp()\r\n        if (!userInfo.data || !corpInfo.data) {\r\n            proxy.$message.error('登录失败')\r\n            return\r\n        }\r\n        setUserInfo(userInfo.data)\r\n        setCorpInfo(corpInfo.data)\r\n        store.commit('setLoginInfo', userInfo.data)\r\n        store.commit('setCorpInfo', corpInfo.data)\r\n        proxy.$message.success('登录成功，正在跳转主页')\r\n        setTimeout(() => {\r\n            // chat_public_key_version > 0表示已经配置会话存档\r\n            // 否则去配置\r\n            if (corpInfo.data?.chat_public_key_version > 0) {\r\n                router.push({path: '/index'})\r\n            } else {\r\n                router.push({path: '/authorizedAccess/guide'})\r\n            }\r\n        }, 1000)\r\n    } catch (e) {\r\n        console.log('Err:', e)\r\n        proxy.$message.error('登录失败')\r\n    }\r\n}\r\n</script>\r\n\r\n<style scoped lang=\"less\">\r\n._main-container {\r\n    background: #E6EFFF;\r\n    min-height: 100vh;\r\n    padding: 24px;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    flex-direction: column;\r\n\r\n    .main-content {\r\n        width: 960px;\r\n        height: 565px;\r\n        border-radius: 16px;\r\n        background: #FFF;\r\n        box-shadow: 0 4px 32px 0 #0000001f;\r\n        display: flex;\r\n\r\n        .left-box {\r\n            width: 480px;\r\n            flex-shrink: 0;\r\n\r\n            .cover {\r\n                width: 100%;\r\n                height: 100%;\r\n            }\r\n        }\r\n\r\n        .right-box {\r\n            flex: 1;\r\n            display: flex;\r\n            align-items: center;\r\n            justify-content: center;\r\n\r\n            //.title {\r\n            //    color: #262626;\r\n            //    font-size: 24px;\r\n            //    font-weight: 600;\r\n            //    margin-bottom: 56px;\r\n            //}\r\n            //\r\n            //.qrcode {\r\n            //    width: 200px;\r\n            //    height: 200px;\r\n            //    border-radius: 10px;\r\n            //    box-shadow: 0 3.33px 26.67px 0 #00000014;\r\n            //    margin: auto;\r\n            //\r\n            //    img {\r\n            //        width: 100%;\r\n            //        height: 100%;\r\n            //    }\r\n            //}\r\n            //\r\n            //.tip-info {\r\n            //    color: #8c8c8c;\r\n            //    font-size: 14px;\r\n            //    font-weight: 400;\r\n            //}\r\n        }\r\n    }\r\n\r\n}\r\n</style>\r\n","import script from \"./login.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./login.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./login.vue?vue&type=style&index=0&id=535b858d&scoped=true&lang=less\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-535b858d\"]])\n\nexport default __exports__"],"names":["exports","sfc","props","target","__vccOpts","key","val","adjustFooterPosition","contentHeight","document","body","scrollHeight","viewportHeight","window","innerHeight","footer","getElementById","classList","add","remove","onMounted","addEventListener","setTimeout","__exports__","__props","store","useStore","loginInfo","computed","getters","getUserInfo","style","background","logout","Modal","confirm","title","content","onOk","message","loading","destroy","logoutHandle","proxy","getCurrentInstance","router","useRouter","ref","async","console","log","ww","SDK_VERSION","process","checkCorpInit","checkInit","then","res","data","init","corp_id","agent_id","loginInit","$message","warning","push","path","finally","value","createWWLoginPanel","el","params","login_type","appid","agentid","redirect_uri","location","origin","state","redirect_type","onCheckWeComLogin","isWeComLogin","onLoginSuccess","code","loginByCode","loginAfterHandle","token","onLoginFail","err","e","error","setAuthToken","userInfo","getCurrentUser","corpInfo","getCurrentCorp","setUserInfo","setCorpInfo","commit","success","chat_public_key_version"],"sourceRoot":""}